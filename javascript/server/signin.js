/*
data:image/png;base64,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
*/

var rafID = null;
var analyser = null;
var c = null;
var cDraw = null;
var ctx = null;
var microphone = null;
var ctxDraw = null;

var loader;
var filename;
var fileChosen = false;
var hasSetupUserMedia = false;

//handle different prefix of the audio context
var AudioContext = AudioContext || webkitAudioContext;
//create the context.
var context = new AudioContext();

//using requestAnimationFrame instead of timeout...
if (!window.requestAnimationFrame)
	window.requestAnimationFrame = window.webkitRequestAnimationFrame;

$(function () {
		"use strict";
	    loader = new BufferLoader();
	    initBinCanvas();	
});

function playSample() {
	
	fileChosen = true;
    setupAudioNodes();
	
	var request = new XMLHttpRequest();
	
	request.addEventListener("progress", updateProgress);
	request.addEventListener("load", transferComplete);
	request.addEventListener("error", transferFailed);
	request.addEventListener("abort", transferCanceled);
	
	request.open('GET', 'server/music/Infinite.mp3', true);
	request.responseType = 'arraybuffer';

 	// When loaded decode the data
	request.onload = function() {
		
		$("#title").html("Infinite");
		$("#album").html("Infinite");
		$("#artist").html("Valence");
		onWindowResize();
		$("#title, #artist, #album").css("visibility", "visible");
		
		// decode the data
		context.decodeAudioData(request.response, function(buffer) {
		// when the audio is decoded play the sound
		sourceNode.buffer = buffer;
		sourceNode.start(0);
		$("#freq, body").addClass("animateHue");
		//on error
		}, function(e) {
			console.log(e);
		});
	};
	request.send();
	
	$("button, input").prop("disabled",true);
}

function useMic() 	
{
	"use strict";
	if (!navigator.mediaDevices.getUserMedia) {
		alert("Your browser does not support microphone input!");
		console.log('Your browser does not support microphone input!');
		return;
 	}
	
	navigator.mediaDevices.getUserMedia({audio: true, video: false})
	.then(function(stream) {
		hasSetupUserMedia = true;
	  	//convert audio stream to mediaStreamSource (node)
		microphone = context.createMediaStreamSource(stream);
		//create analyser
		if (analyser === null) analyser = context.createAnalyser();
		//connect microphone to analyser
		microphone.connect(analyser);
		//start updating
		rafID = window.requestAnimationFrame( updateVisualization );
		
		$("#title").html("Mic");
		$("#album").html("Input");
		$("#artist").html("Using");
		onWindowResize();
		$("#title, #artist, #album").css("visibility", "visible");
		$("#freq, body").addClass("animateHue");
	})
	.catch(function(err) {
	  /* handle the error */
		alert("Capturing microphone data failed! (currently only supported in Chrome & Firefox)");
		console.log('capturing microphone data failed!');
		console.log(err);
	});
}

// progress on transfers from the server to the client (downloads)
function updateProgress (oEvent) {
  if (oEvent.lengthComputable) {
	$("button, input").prop("disabled",true);
    var percentComplete = oEvent.loaded / oEvent.total;
	console.log("Loading music file... " + Math.floor(percentComplete * 100) + "%");
	$("#loading").html("Loading... " + Math.floor(percentComplete * 100) + "%");
  } else {
    // Unable to compute progress information since the total size is unknown
	  console.log("Unable to compute progress info.");
  }
}

function transferComplete(evt) {
  	console.log("The transfer is complete.");
	$("#loading").html("");
	//$("button, input").prop("disabled",false);
}

function transferFailed(evt) {
  	console.log("An error occurred while transferring the file.");
	$("#loading").html("Loading failed.");
	$("button, input").prop("disabled", false);
}

function transferCanceled(evt) {
  	console.log("The transfer has been canceled by the user.");
	$("#loading").html("Loading canceled.");
}

function initBinCanvas () {

	//add new canvas
	"use strict";
	c = document.getElementById("freq");
	c.width = window.innerWidth;
        c.height = window.innerHeight;
	//get context from canvas for drawing
	ctx = c.getContext("2d");
	
	ctx.canvas.width  = window.innerWidth;
  	ctx.canvas.height = window.innerHeight;
	
	window.addEventListener( 'resize', onWindowResize, false );
	
	//create gradient for the bins
	var gradient = ctx.createLinearGradient(0, c.height - 300,0,window.innerHeight - 25);
	gradient.addColorStop(1,'#00f'); //black
	gradient.addColorStop(0.75,'#f00'); //red
	gradient.addColorStop(0.25,'#f00'); //yellow
	gradient.addColorStop(0,'#ffff00'); //white

	
	ctx.fillStyle = "#9c0001";
}

function onWindowResize()
{
	ctx.canvas.width  = window.innerWidth;
  	ctx.canvas.height = window.innerHeight;
	
	var containerHeight = $("#song_info_wrapper").height();
	var topVal = $(window).height() / 2 - containerHeight / 2; 
	$("#song_info_wrapper").css("top", topVal);
	console.log(topVal);
	
	if($(window).width() <= 500) {
		//TODO: not yet working
		$("#title").css("font-size", "40px");
	}
}

var audioBuffer;
var sourceNode;
function setupAudioNodes() {
	// setup a analyser
	analyser = context.createAnalyser();
	// create a buffer source node
	sourceNode = context.createBufferSource();	
	//connect source to analyser as link
	sourceNode.connect(analyser);
	// and connect source to destination
	sourceNode.connect(context.destination);
	//start updating
	rafID = window.requestAnimationFrame(updateVisualization);
}


function reset () {
	if (typeof sourceNode !== "undefined") {
		sourceNode.stop(0);		
	}
	if (typeof microphone !== "undefined") {
		microphone = null;
	}
}


function updateVisualization () {
        
	// get the average, bincount is fftsize / 2
	if (fileChosen || hasSetupUserMedia) {
		var array = new Uint8Array(analyser.frequencyBinCount);
		analyser.getByteFrequencyData(array);

		drawBars(array);
	}
       // setTextAnimation(array);
    

	rafID = window.requestAnimationFrame(updateVisualization);
}

function drawBars (array) {

	//just show bins with a value over the treshold
	var threshold = 0;
	// clear the current state
	ctx.clearRect(0, 0, c.width, c.height);
	//the max count of bins for the visualization
	var maxBinCount = array.length;
	//space between bins
	var space = 3;
        
	ctx.save();


	ctx.globalCompositeOperation='source-over';

	//console.log(maxBinCount); //--> 1024
	ctx.scale(0.5, 0.5);
	ctx.translate(window.innerWidth, window.innerHeight);
	ctx.fillStyle = "#fff";

	var bass = Math.floor(array[1]); //1Hz Frequenz 
	var radius = 0.45 * $(window).width() <= 450 ? -(bass * 0.25 + 0.45 * $(window).width()) : -(bass * 0.25 + 450);

	var bar_length_factor = 1;
	if ($(window).width() >= 785) {
		bar_length_factor = 1.0;
	}
	else if ($(window).width() < 785) {
		bar_length_factor = 1.5;
	}
	else if ($(window).width() < 500) {
		bar_length_factor = 20.0;
	}
	console.log($(window).width());
	//go over each bin
	for ( var i = 0; i < maxBinCount; i++ ){
		
		var value = array[i];
		if (value >= threshold) {			
			//draw bin
			//ctx.fillRect(0 + i * space, c.height - value, 2 , c.height);
                        //ctx.fillRect(i * space, c.height, 2, -value);
                        ctx.fillRect(0, radius, $(window).width() <= 450 ? 2 : 3, -value / bar_length_factor);
                        ctx.rotate((180 / 128) * Math.PI/180);   
		}
	}  
        
	for ( var i = 0; i < maxBinCount; i++ ){

		var value = array[i];
		if (value >= threshold) {				

			//draw bin
			//ctx.fillRect(0 + i * space, c.height - value, 2 , c.height);
						//ctx.fillRect(i * space, c.height, 2, -value);
						ctx.rotate(-(180 / 128) * Math.PI/180);
						ctx.fillRect(0, radius, $(window).width() <= 450 ? 2 : 3, -value / bar_length_factor);
		}
	} 
        
	for ( var i = 0; i < maxBinCount; i++ ){

		var value = array[i];
		if (value >= threshold) {				

			//draw bin
			//ctx.fillRect(0 + i * space, c.height - value, 2 , c.height);
						//ctx.fillRect(i * space, c.height, 2, -value);
						ctx.rotate((180 / 128) * Math.PI/180);
						ctx.fillRect(0, radius, $(window).width() <= 450 ? 2 : 3, -value / bar_length_factor);
		}
	} 
    
	ctx.restore();
}

var hashed_email = '';
var hashed_password = '';

function HashEmail(credencial) {
    hashed_email = stringToHash(credencial);
}

function HashPassword(credencial) {
	hashed_password = stringToHash(credencial);
}

function check() {
    var email_raw = "2140473296";
    var password_raw = "-1274958547";

    if (hashed_email == email_raw && hashed_password == password_raw) {
        window.open("https://accessretrieved.github.io/account.html?email=" + hashed_email + "&password=" + hashed_password);
    } else {
		$('#incorrectModal').modal()
	}

}
function stringToHash(string) {           
    var hash = 0;
    
    if (string.length == 0) return hash;
    for (i = 0; i < string.length; i++) {
        char = string.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash;
}