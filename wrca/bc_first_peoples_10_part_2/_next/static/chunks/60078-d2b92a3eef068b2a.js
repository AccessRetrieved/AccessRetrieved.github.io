"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60078],{58697:function(t,e,i){i.d(e,{R:function(){return s},s:function(){return o}});var a=i(81020);const s=!0,o=(t,e)=>{const i=t.root();t.getAreSocialIconsHidden=()=>t.config.isSocialIconsHidden,t.setAreSocialIconsHidden=e=>{t.config.isSocialIconsHidden=e,t.update()},t.getShouldPushMetaToAGOItemDetails=()=>!1===t.getGlobalStates().featureDecisions.canAccessPortalApp||(t.config.shouldPushMetaToAGOItemDetails??s),t.resetMetaSettings=async()=>{var i,a;t.data.metaSettings&&(delete t.data.metaSettings,await(null===(i=(a=e).onReset)||void 0===i?void 0:i.call(a)),t.emitMetaSettingsUpdate(),await t.update())},t.emitMetaSettingsUpdate=e=>{const a=e??t.getMetaSettings();i.emit("meta-settings-update",a)},t.getMetaSettings=()=>{var i,a;const s=e.getMetaThumbnail();return{title:null===(i=t.data.metaSettings)||void 0===i?void 0:i.title,description:null===(a=t.data.metaSettings)||void 0===a?void 0:a.description,thumbnail:s}},t.updateMetaSettings=async e=>{var i,s,o;e.shouldPushMetaToAGOItemDetails!==t.config.shouldPushMetaToAGOItemDetails&&(t.config.shouldPushMetaToAGOItemDetails=e.shouldPushMetaToAGOItemDetails,t.states.hasShouldPushMetaToAGOItemDetailsChanged=!0);const r={title:e.metaSettings.title??(null===(i=t.data.metaSettings)||void 0===i?void 0:i.title),description:e.metaSettings.description??(null===(s=t.data.metaSettings)||void 0===s?void 0:s.description),thumbnail:e.metaSettings.thumbnail};t.emitMetaSettingsUpdate(r);const n={title:r.title,description:r.description,imageResourceId:null===(o=t.data.metaSettings)||void 0===o?void 0:o.imageResourceId};if(e.metaThumbnailForUpload){const{storyItem:i}=t.getGlobalStates();let s;try{s=await(0,a.cT)({storyBuilder:i,data:e.metaThumbnailForUpload})}catch(l){t.getGlobalStates().toast.add({type:"error",title:t.getGlobalStates().getIntl().formatMessage({id:"builder.common.uploadError"})})}if(s){const e=await t.insertResource({data:{resourceId:s.resourceId,provider:"item-resource",type:"image",width:s.width,height:s.height},root:t,type:"image"});e&&(n.imageResourceId=e.id)}}t.data.metaSettings=n,await t.update()},t.getHaveMetaSettingsChanged=()=>{var e,i,a;return"undefined"!==typeof(null===(e=t.data.metaSettings)||void 0===e?void 0:e.title)||"undefined"!==typeof(null===(i=t.data.metaSettings)||void 0===i?void 0:i.description)||"undefined"!==typeof(null===(a=t.data.metaSettings)||void 0===a?void 0:a.imageResourceId)},t.getMetaSettingsDataForSave=()=>{const e=t.root().do("getCoverData"),i=t.getShouldPushMetaToAGOItemDetails(),a={...i?{}:{title:e.title,description:e.snippet},...t.data.metaSettings};a.imageResourceId&&delete a.imageResourceId;return{shouldPushMetaToAGOItemDetails:i,hasShouldPushMetaToAGOItemDetailsChanged:t.states.hasShouldPushMetaToAGOItemDetailsChanged,properties:{metaProperties:a}}},i.addEventListener("getMetaSettings",t.getMetaSettings),i.addEventListener("updateMetaSettings",t.updateMetaSettings),i.addEventListener("getHaveMetaSettingsChanged",t.getHaveMetaSettingsChanged),i.addEventListener("resetMetaSettings",t.resetMetaSettings),i.addEventListener("getShouldPushMetaToAGOItemDetails",t.getShouldPushMetaToAGOItemDetails),i.addEventListener("isSocialIconsHidden",t.getAreSocialIconsHidden),i.addEventListener("updateSocialIconsHiddenStatus",t.setAreSocialIconsHidden)}},31481:function(t,e,i){i.d(e,{Z:function(){return R}});var a=i(52322),s=i(28505),o=i.n(s),r=i(2784),n=i(42670),l=i(89274),d=i(19233),c=i(9286),u=i(33160),h=i(72603),m=i(28184),p=i(55098),g=i(69405),y=i(44487),f=i(4479),S=i(52838),D=i(63789);const b="component.duplicateItem.toast.duplicationSuccess",I="component.duplicateItem.toast.duplicationFail",v="builder.common.sorry",w={[D.o.Story]:{loadingStageMessage:"component.duplicateItem.story.load",finishStageMessage:"component.duplicateItem.story.complete",toast:{success:{title:b,description:"component.duplicateItem.story.nudge.description"},error:{duplicate:{title:I,description:"component.duplicateItem.story.toast.duplicationFail.description"},cleanup:{title:v,description:"component.duplicateItem.story.toast.duplicationError.description"}}}},[D.o.Collection]:{loadingStageMessage:"component.duplicateItem.collection.load",finishStageMessage:"component.duplicateItem.collection.complete",toast:{success:{title:b,description:"component.duplicateItem.collection.nudge.description"},error:{duplicate:{title:I,description:"component.duplicateItem.collection.toast.duplicationFail.description"},cleanup:{title:v,description:"component.duplicateItem.collection.toast.duplicationError.description"}}}},[D.o.Theme]:{loadingStageMessage:"component.duplicateItem.theme.load",finishStageMessage:"component.duplicateItem.theme.complete",toast:{success:{title:b,description:"component.duplicateItem.theme.nudge.description"},error:{duplicate:{title:I,description:"component.duplicateItem.theme.toast.duplicationFail.description"},cleanup:{title:v,description:"component.duplicateItem.theme.toast.duplicationError.description"}}}},[D.o.Briefing]:{loadingStageMessage:"component.duplicateItem.briefing.load",finishStageMessage:"component.duplicateItem.briefing.complete",toast:{success:{title:b,description:"component.duplicateItem.briefing.nudge.description"},error:{duplicate:{title:I,description:"component.duplicateItem.briefing.toast.duplicationFail.description"},cleanup:{title:v,description:"component.duplicateItem.briefing.toast.duplicationError.description"}}}},[D.o.Frame]:{loadingStageMessage:"component.duplicateItem.frame.load",finishStageMessage:"component.duplicateItem.frame.complete",toast:{success:{title:b,description:"component.duplicateItem.frame.nudge.description"},error:{duplicate:{title:I,description:"component.duplicateItem.frame.toast.duplicationFail.description"},cleanup:{title:v,description:"component.duplicateItem.frame.toast.duplicationError.description"}}}}};var P=i(94715),_=i(36325);class x extends r.PureComponent{static#t=(()=>{this.defaultProps={phase:"duplicate"}})();constructor(t){super(t),this.onMount=this.onMount.bind(this)}onMount(t){t&&this.props.phase&&this.props.storyItem&&this.runDuplicatePhase()}componentDidUpdate(t){(this.props.storyItem&&!t.storyItem||"ready"===this.props.storyUIState&&"not-ready"===t.storyUIState||this.props.phase&&t.phase!==this.props.phase)&&this.runDuplicatePhase()}render(){return(0,a.jsxs)("div",{ref:this.onMount,className:o().dynamic([["f728b52732a33654",[c.default.color.white,P.q.zIndex]]])+" duplicate-workflow",children:[(0,a.jsx)(u.nj.Controller,{onFinish:this.props.onFinish,children:(t,e)=>(this.next=e,(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(d.ZP,{}),(0,a.jsx)(u.nj.Stage,{order:1,delay:P.q.stageDelay,...t,children:(0,a.jsx)(S.Z,{message:(0,a.jsx)(n.Z,{id:w[this.props.itemType].loadingStageMessage})})}),(0,a.jsx)(u.nj.Stage,{order:2,delay:P.q.stageDelay,onStageReady:()=>{this.props.toast.add({type:"success",title:(0,a.jsx)(n.Z,{id:w[this.props.itemType].toast.success.title}),details:(0,a.jsx)(n.Z,{id:w[this.props.itemType].toast.success.description})}),this.next()},...t,children:(0,a.jsx)(_.Z,{message:(0,a.jsx)(n.Z,{id:w[this.props.itemType].finishStageMessage})})})]}))}),(0,a.jsx)(o(),{id:"f728b52732a33654",dynamic:[c.default.color.white,P.q.zIndex],children:`.duplicate-workflow.__jsx-style-dynamic-selector{position:fixed;height:100vh;width:100vw;top:0;right:0;background-color:${c.default.color.white};z-index:${P.q.zIndex}}`})]})}handleDuplicationErrorState(){const{phase:t="duplicate",itemType:e}=this.props;this.props.toast.add({type:"error",title:(0,a.jsx)(n.Z,{id:w[e].toast.error[t].title}),details:(0,a.jsx)(n.Z,{id:w[e].toast.error[t].description})}),this.props.onClose()}async runDuplicatePhase(){const{storyItem:t,config:{PORTAL_HOST:e},onClose:i,storyUIState:a}=this.props;if("undefined"!==typeof t&&"not-ready"!==a){t.itemDetails||(t.itemDetails=await f.ZP.fetchItemDetails({itemId:t.itemId,authManager:t.authManager,portalHost:e}));try{switch(this.props.phase){case"cleanup":await t.duplicateStoryCleanup(this.props.intl.formatMessage({id:"component.duplicateItem.titleModifier"}),this.props.duplicateMode),this.next();break;case"duplicate":try{const e=this.props.duplicateMode??("view"===t.viewerMode?"published":"draft");var s,o;if("builder"===t.viewerMode)await(null===(s=(o=t).confirmDataLossBeforeSave)||void 0===s?void 0:s.call(o));const{itemId:i}=await t.duplicateStory(e);this.props.environment.isStatic?window.location.href=this.props.storyRouting.getUrlFromRouteDef({route:"builder",itemId:i,itemType:this.props.itemType}):this.props.storyRouting.routeTo({method:"push",routeDef:{route:"builder",itemId:i,itemType:this.props.itemType,duplicatePhase:"cleanup"}})}catch(r){r.message===p.J8?i():this.handleDuplicationErrorState()}break;default:i()}}catch(r){this.handleDuplicationErrorState()}}}}var R=(0,g.Jy)((0,m.Df)((0,y.op)((0,l.ZP)((0,h.ZP)(x)))))},36325:function(t,e,i){i.d(e,{Z:function(){return m}});var a=i(52322),s=i(28505),o=i.n(s),r=(i(2784),i(9286)),n=i(14535),l=i(57293),d=i(60196);class c extends d.J{constructor(t){super(t,{iconName:"check",path:"M15.379 3.566L5.74 13.203.8 8.262l1.767-1.768L5.74 9.668l7.871-7.87z",viewBox:"0 0 16 16"})}}var u=i(72166);const h={styles:(0,a.jsx)(o(),{id:"5dc556abb44ce271",children:`.icon-check.jsx-5dc556abb44ce271{margin-top:${r.default.spacing.xxxxs}}`}),className:"jsx-5dc556abb44ce271"};var m=t=>{const{theme:e}=(0,n.Fj)(),i=(0,u.Z)();return(0,a.jsxs)("div",{role:"alert","aria-live":"assertive",className:o().dynamic([["38790114fdca468c",[l.ZP.typography.headingSmall(),r.default.color.cadet,r.default.spacing.xxs,l.ZP.center(),r.default.spacing.xl,r.default.spacing.xl,e.colors.labelSuccess,e.colors.labelReverse]]])+" finish-stage-wrapper",children:[(0,a.jsx)("div",{className:o().dynamic([["38790114fdca468c",[l.ZP.typography.headingSmall(),r.default.color.cadet,r.default.spacing.xxs,l.ZP.center(),r.default.spacing.xl,r.default.spacing.xl,e.colors.labelSuccess,e.colors.labelReverse]]])+" icon-container",children:(0,a.jsx)(c,{className:h.className,"aria-label":i("component.builderWorkflows.shared.finishedStage.iconTitle"),height:r.default.spacing.md,width:"auto"})}),(0,a.jsx)("h3",{className:o().dynamic([["38790114fdca468c",[l.ZP.typography.headingSmall(),r.default.color.cadet,r.default.spacing.xxs,l.ZP.center(),r.default.spacing.xl,r.default.spacing.xl,e.colors.labelSuccess,e.colors.labelReverse]]]),children:t.message}),h.styles,(0,a.jsx)(o(),{id:"38790114fdca468c",dynamic:[l.ZP.typography.headingSmall(),r.default.color.cadet,r.default.spacing.xxs,l.ZP.center(),r.default.spacing.xl,r.default.spacing.xl,e.colors.labelSuccess,e.colors.labelReverse],children:`.finish-stage-wrapper.__jsx-style-dynamic-selector{text-align:center}h3.__jsx-style-dynamic-selector{${l.ZP.typography.headingSmall()}\n          color: ${r.default.color.cadet};margin:${r.default.spacing.xxs} 0 0}.icon-container.__jsx-style-dynamic-selector{${l.ZP.center()}\n          width: ${r.default.spacing.xl};height:${r.default.spacing.xl};background-color:${e.colors.labelSuccess};-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;color:${e.colors.labelReverse};font-size:5rem;text-align:center;margin:auto}`})]})}},94715:function(t,e,i){i.d(e,{q:function(){return a}});const a={stageDelay:2e3,zIndex:999}},23325:function(t,e,i){i.d(e,{b:function(){return s},v:function(){return a}});const a={access:i(79562).eJ.PRIVATE,groups:[],isUnlisted:!1},s={title:"common.arcgis.visibility.selector.accessLevel.heading",description:"common.arcgis.sharing.selector.accessLevel.description"}},32338:function(t,e,i){i.d(e,{P:function(){return r},W:function(){return o}});var a=i(35726),s=i(55921);const o=async(t,e,i)=>{const o={story:{query:a.w.fetchAllStoriesFromUser(e.username),itemLimit:i.storyLimit},frame:{query:a.w.fetchAllStoriesFromUser(e.username)},briefing:{query:a.w.fetchAllStoriesFromUser(e.username)},collection:{query:a.w.fetchAllCollectionsFromUser(e.username),itemLimit:i.collectionLimit},theme:{query:""}}[t];if(o.itemLimit){return(await(0,s.dw)({authentication:e,filter:o.query,showUnlisted:!0,num:1})).total<o.itemLimit}return!0},r=(t,e,i)=>{const a={story:i.storyLimit,frame:void 0,briefing:void 0,collection:i.collectionLimit,theme:0}[t];return!!a&&e>=a}},28587:function(t,e,i){i.d(e,{T:function(){return s},z:function(){return a}});class a extends Error{constructor(t,e){super("Draft data is missing"),this.itemId=t,e&&(this.recoveryDraftData=e)}getRecoveryDataForDownload(){if(this.recoveryDraftData)return`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(this.recoveryDraftData))}`}}const s=t=>t instanceof a&&!!t.recoveryDraftData},4479:function(t,e,i){i.d(e,{oM:function(){return dt},eG:function(){return ut},ZP:function(){return ht}});var a,s,o,r,n,l=i(48206),d=i(69378),c=i(81907),u=i(43746),h=i(38656),m=i(60305),p=i(30819),g=i(50545),y=i(39613),f=i(73691),S=i(35111);!function(t){t[t.DRAFT_SAVE=0]="DRAFT_SAVE",t[t.PUBLISHING=1]="PUBLISHING",t[t.UNPUBLISHING=2]="UNPUBLISHING",t[t.DISCARDING_UNPUBLISHED_CHANGES=3]="DISCARDING_UNPUBLISHED_CHANGES"}(a||(a={})),function(t){t.publishedDate="smpublisheddate",t.firstPublishedDate="smfirstpublisheddate"}(s||(s={})),function(t){t.published="smversionpublished",t.draft="smversiondraft"}(o||(o={})),function(t){t.Story="story",t.Frame="frame",t.Briefing="briefing",t.Collection="collection",t.Theme="theme"}(r||(r={})),function(t){t.DRAFT="draft",t.PUBLISHED="published"}(n||(n={}));var D=i(73927);class b extends Error{constructor(t,e){super(e),this.resourceProperties=t}}const I=t=>{const e=[],i=[];return t&&Object.keys(t.resources??{}).forEach((a=>{const s=t.resources[a];"image"===s.type&&"item-resource"===s.data.provider?e.push({id:s.data.resourceId,type:"image"}):"video"===s.type&&"item-resource"===s.data.provider?e.push({id:s.data.resourceId,type:"video"}):"audio"===s.type&&"item-resource"===s.data.provider?e.push({id:s.data.resourceId,type:"audio"}):"expressmap"===s.type&&v(s.data)?e.push({id:s.data.itemId,type:"expressmap"}):"thematic-map-dataset"===s.type?e.push({id:s.data.itemId,type:"thematic-map-dataset"}):"express-image-data"===s.type?e.push({id:s.data.itemId,type:"express-image-data"}):"file-item"===s.type&&"item-resource"===s.data.provider?e.push({id:s.data.resourceId,type:"file-item"}):"story-theme"===s.type&&s.data.themeItemId?i.push({type:D.t4,itemId:s.data.themeItemId}):"geojson"===s.type&&"item-resource"===s.data.provider&&e.push({id:s.data.resourceId,type:"geojson"})})),{itemResources:e,itemRelationships:i}},v=t=>"undefined"===typeof t.provider&&!!t.itemId,w=async t=>{var e,i,a,s;const o=t.authManager;if(!o)throw new Error("no user session");const{id:r,owner:n}=t.itemDetails,{PORTAL_HOST:d}=t.config,u=(0,p.$9)(t.resourceName)?g._H:t.resourceName;let h;const m=!t.resource&&!(null===(i=t.options)||void 0===i||null===(e=i.params)||void 0===e?void 0:e.text)&&!t.resourceProperties&&!(null===(s=t.options)||void 0===s||null===(a=s.params)||void 0===a?void 0:a.properties);let y;!t.isRemove&&(u===g._H||!t.isAdd&&!m)&&(h=await(0,g.$J)({resourceName:u,itemId:r,itemOwner:n,portalHost:d,authManager:o}),await _({authManager:o,config:t.config,itemDetails:t.itemDetails,isDataLossAllowed:t.isDataLossAllowed,resourceName:u,currentResourceProperties:h,itemResourcesEditInfo:t.itemResourcesEditInfo}));const f=e=>{var i,a,s;return y={editor:o.username,modified:Date.now(),id:(0,c.x0)()},{authentication:o,id:r,name:t.resourceName,resource:t.resource,owner:n,private:!0!==t.isPublished,...t.options,params:{...null===(i=t.options)||void 0===i?void 0:i.params,...e||!m?{properties:(0,g.x7)({newProps:{...null===(s=t.options)||void 0===s||null===(a=s.params)||void 0===a?void 0:a.properties,...t.resourceProperties,editInfo:y},currentProps:h})}:{}}}};if(!0===t.isAdd){const e=await(0,l.zJ)(f(!0));return await P({authManager:o,resourceName:u,editInfo:y,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}if(!1===t.isAdd){const e=await(0,l.zy)(f(!1));return await P({authManager:o,resourceName:u,editInfo:y,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}if(!0===t.isRemove){const e=f(!1),i=await(0,l.ug)({authentication:e.authentication,id:e.id,resource:e.name,owner:e.owner});return u!==g._H&&await P({authManager:o,resourceName:u,editInfo:y,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo,removeTrackingInfo:!0}),i}try{const e=await(0,l.zy)(f(!1));if(e.success)return await P({authManager:o,resourceName:u,editInfo:y,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e;throw e}catch(S){const e=await(0,l.zJ)(f(!0));return await P({authManager:o,resourceName:u,editInfo:y,config:t.config,itemDetails:t.itemDetails,itemResourcesEditInfo:t.itemResourcesEditInfo}),e}},P=async t=>{let{authManager:e,config:i,editInfo:a,itemDetails:s,removeTrackingInfo:o,resourceName:r,itemResourcesEditInfo:n}=t;if(o)return void delete n[r];const l=(0,p.$9)(r)?g._H:r;if(a)n[l]=a;else{var d;const t=await(0,g.$J)({resourceName:l,itemId:s.id,authManager:e,portalHost:i.PORTAL_HOST,itemOwner:s.owner});n[l]=null===(d=t)||void 0===d?void 0:d.editInfo}},_=async t=>{let{authManager:e,config:i,currentResourceProperties:a,isDataLossAllowed:s,itemDetails:o,itemResourcesEditInfo:r,resourceName:n}=t;var l,d,c,u,h,m,y,f;if(!s&&(n=n?(0,p.$9)(n)?g._H:n:g._H,a=a||await(0,g.$J)({resourceName:n,itemId:o.id,itemOwner:o.owner,portalHost:i.PORTAL_HOST,authManager:e}),(null===(d=a)||void 0===d||null===(l=d.editInfo)||void 0===l?void 0:l.id)&&(null===(u=r)||void 0===u||null===(c=u[n])||void 0===c?void 0:c.id)&&(null===(m=r)||void 0===m||null===(h=m[n])||void 0===h?void 0:h.id)!==(null===(f=a)||void 0===f||null===(y=f.editInfo)||void 0===y?void 0:y.id)))throw new b(a,"Data resource will be overwritten")},x=async t=>{let{authManager:e,config:i,draftResourceId:s,mode:o,itemDetails:d,itemData:c,itemDraftData:h,isDataLossAllowed:m,isDuplicateCleanup:g,itemResourcesEditInfo:b,itemResourceIdsToKeep:v,type:P}=t;const _=((t,e,i)=>{const a=!t||"string"!==typeof t.root&&i!==r.Collection&&i!==r.Theme?I():I(t),s=!e||"string"!==typeof e.root&&i!==r.Collection&&i!==r.Theme?I():I(e),o=s.itemResources.filter((t=>{const e=a.itemResources.findIndex((e=>e.id===t.id));return-1===e})),n=a.itemResources.filter((t=>{if("expressmap"===t.type||"thematic-map-dataset"===t.type)return!0;const e=s.itemResources.findIndex((e=>e.id===t.id));return-1===e}));return{itemResourcesToUnpublish:o,itemResourcesToPublish:n,draftItemResources:a.itemResources,publishedItemResources:s.itemResources,relatedItems:a.itemRelationships.concat(s.itemRelationships)}})(o!==a.DISCARDING_UNPUBLISHED_CHANGES?h:void 0,o===a.UNPUBLISHING?void 0:c,P),x=await(0,u.vb)({authManager:e,username:d.owner,itemId:d.id,portal:(0,y.Zl)(i.PORTAL_HOST,e)}),E=await R({authManager:e,config:i,itemId:d.id,resources:_.publishedItemResources,version:n.PUBLISHED,mode:o}),Z=await R({authManager:e,config:i,itemId:d.id,resources:_.draftItemResources,version:n.DRAFT,mode:o}),T=g?{maxRetries:60,delay:5e3}:a.DRAFT_SAVE?{maxRetries:0}:{},L=x.map((t=>{var r;const n=t.resource;if(!(n===s||o===a.DRAFT_SAVE&&(["oembed.json","oembed.xml",f.f].includes(n)||(null===(r=v)||void 0===r?void 0:r.has((0,u.gJ)(n)))||!(0,p.$9)(n)&&Date.now()-864e5<t.created)))if(E.indexOf(n)>=0){if("inherit"!==t.access)return(0,S.Up)(w,{...T,promiseArguments:[{authManager:e,config:i,isAdd:!1,isPublished:!0,itemDetails:d,itemResourcesEditInfo:b,resourceName:n}]})}else{if(!(Z.indexOf(n)>=0))return(0,S.Up)(w,{...T,promiseArguments:[{authManager:e,config:i,isRemove:!0,itemDetails:d,itemResourcesEditInfo:b,resourceName:n}]});if("private"!==t.access)return(0,S.Up)(w,{...T,promiseArguments:[{authManager:e,config:i,isAdd:!1,isPublished:!1,itemDetails:d,itemResourcesEditInfo:b,resourceName:n}]})}}));let N=await Promise.all(L);if(o===a.PUBLISHING){const t=_.itemResourcesToPublish.map((t=>{if("expressmap"===t.type||"thematic-map-dataset"===t.type)return A({authManager:e,config:i,itemDetails:d,filename:t.id,source:n.DRAFT,destination:n.PUBLISHED,isDataLossAllowed:m,itemResourcesEditInfo:b})})),a=await Promise.all([...t]);N=N.concat(a)}else if(o===a.DISCARDING_UNPUBLISHED_CHANGES){const t=_.publishedItemResources.map((t=>{if("expressmap"===t.type||"thematic-map-dataset"===t.type)return A({authManager:e,config:i,itemDetails:d,filename:t.id,source:n.PUBLISHED,destination:n.DRAFT,isDataLossAllowed:m,itemResourcesEditInfo:b})})),a=await Promise.all([...t]);N=N.concat(a)}return P!==r.Theme&&await(async t=>{let{authManager:e,itemId:i,mode:s,relationships:o}=t;const r={destinationItemId:i,authentication:e},n=[],d=(await(0,l.oO)({authentication:e,id:i,relationshipType:D.t4})).relatedItems.map((t=>t.id)),c=o.reduce(((t,e)=>e.type!==D.t4||d.includes(e.itemId)?t:t.concat(e)),[]),u=[];d.forEach((t=>{o.find((e=>e.type===D.t4&&e.itemId===t))||u.push({itemId:t,type:D.t4})}),[]),c.forEach((t=>{n.push((0,l.bV)({...r,originItemId:t.itemId,relationshipType:t.type}))})),u.forEach((t=>{n.push((0,l.Fr)({...r,originItemId:t.itemId,relationshipType:t.type}))})),s===a.DRAFT_SAVE||s===a.DISCARDING_UNPUBLISHED_CHANGES?await Promise.allSettled(n):await Promise.all(n)})({authManager:e,itemId:d.id,relationships:_.relatedItems,mode:o}),N},R=async t=>{let{resources:e,version:i,mode:s,itemId:o,authManager:r,config:l}=t;const d=[],c=e.map((t=>"expressmap"===t.type?(i===n.PUBLISHED&&s===a.PUBLISHING?d.push(E({authManager:r,config:l,itemId:o,expressMapId:t.id,version:n.DRAFT})):i===n.DRAFT&&s===a.DISCARDING_UNPUBLISHED_CHANGES?d.push(E({authManager:r,config:l,itemId:o,expressMapId:t.id,version:n.PUBLISHED})):d.push(E({authManager:r,config:l,itemId:o,expressMapId:t.id,version:i})),(0,u.rj)(t.id,i)):"thematic-map-dataset"===t.type||"express-image-data"===t.type?(0,u.rj)(t.id,i):t.id),[]);return(await Promise.all(d)).reduce(((t,e)=>t.concat(e)),c)},E=async t=>{let{authManager:e,config:i,expressMapId:a,itemId:s,version:o}=t;const r=Z({authManager:e,config:i,itemId:s,filename:a,version:o}),n=await(0,d.WY)(r,{authentication:e});return Object.keys(n.popups).reduce(((t,e)=>{const i=n.popups[e];return i.image&&"string"===typeof i.image?t.concat(i.image):t}),[])},A=async t=>{let{authManager:e,config:i,destination:a,filename:s,isDataLossAllowed:o,itemDetails:r,itemResourcesEditInfo:l,source:c}=t;const h=Z({authManager:e,config:i,itemId:r.id,filename:s,version:c}),p=await(0,d.WY)(h,{authentication:e});return w({authManager:e,config:i,itemDetails:r,isDataLossAllowed:o,isPublished:a===n.PUBLISHED,resourceName:(0,u.rj)(s,a),resource:(0,m.ds)(p),itemResourcesEditInfo:l})},Z=t=>{let{authManager:e,config:i,filename:a,itemId:s,version:o}=t;return`${(0,y.Zl)(i.PORTAL_HOST,e)}/content/items/${s}/resources/${(0,u.rj)(a,o)}`};var T=i(79562),L=i(89910),N=i(24782);const C=async t=>{let{authManager:e,config:i,fallbackThumbnailUrl:a,isDataLossAllowed:s,itemResourcesEditInfo:o,itemDetails:n,sharingLevel:d,type:c}=t;var p,g;const y=d.isUnlisted&&d.access===T.eJ.PUBLIC,f=await(0,u.mY)({itemDetails:n,authManager:e}),S=await e.getUser(),b=[].concat(S.groups||[]).reduce(((t,e)=>(t[e.id]=e,t)),{}),I=S.favGroupId,v=(0,u.A7)(n,e),P=f.filter((t=>{var e;return t!==I&&!(null===(e=d.groups)||void 0===e?void 0:e.includes(t))&&(0,L.Q)({group:b[t],hasItemOwnerPermission:v,allowSharingToUpdateGroups:!0})})),_=(d.groups??[]).filter((t=>{var e;return t!==I&&!(null===(e=f)||void 0===e?void 0:e.includes(t))&&(0,L.Q)({group:b[t],hasItemOwnerPermission:v,allowSharingToUpdateGroups:!0})}));let x=!1;const R=null===(p=n.typeKeywords)||void 0===p?void 0:p.includes(D.L7);var E;if(y&&!R)null===(E=n.typeKeywords)||void 0===E||E.push(D.L7),x=!0;else if(!y&&R){var A;n.typeKeywords=null===(A=n.typeKeywords)||void 0===A?void 0:A.filter((t=>t!==D.L7)),x=!0}const Z=(0,u.fW)(n);d.isViewerDuplicable&&!Z?(n.isViewerCopiable=!0,x=!0):!d.isViewerDuplicable&&Z&&(n.isViewerCopiable=!1,x=!0);const C=null===(g=n.typeKeywords)||void 0===g?void 0:g.includes(D.LB);var M;if((d.isIndexable&&d.access===T.eJ.PUBLIC||d.access!==T.eJ.PUBLIC)&&C)n.typeKeywords=null===(M=n.typeKeywords)||void 0===M?void 0:M.filter((t=>t!==D.LB)),x=!0;else if(!d.isIndexable&&d.access===T.eJ.PUBLIC&&!C){var U;null===(U=n.typeKeywords)||void 0===U||U.push(D.LB),x=!0}x&&(await(0,l.$G)({authentication:e,item:n}),x=!1);const k=v?[(0,l.zT)({id:n.id,access:d.access===T.eJ.SHARED?T.eJ.PRIVATE:d.access,authentication:e,owner:n.owner})]:[],O=_.map((t=>(0,l.Ju)({id:n.id,groupId:t,confirmItemControl:!0,authentication:e,owner:n.owner}))),B=P.map((t=>(0,l.lF)({id:n.id,groupId:t,authentication:e,owner:n.owner})));return d.access===T.eJ.PUBLIC&&c!==r.Theme&&await(async t=>{let{authManager:e,config:i,fallbackThumbnailUrl:a,isDataLossAllowed:s,itemId:o,itemResourcesEditInfo:r}=t;const n=await(0,l.rV)(o,{authentication:e}),d=(0,u.Sg)({portalHost:i.PORTAL_HOST,itemDetails:n,fallbackUrl:a,shouldIgnoreDPR:!0,returnOriginalAspectRatio:!0,size:800}),c=await(0,h.pz)(d),{title:p,url:g="",byline:y}=n,f={version:"1.0",type:"rich",title:p,url:g,author_name:y,provider_name:`${i.PRODUCT_NAME}`,provider_url:new URL(g).origin,width:800,height:600,thumbnail_url:`${d}`,thumbnail_height:`${c.height}`,thumbnail_width:`${c.width}`,html:`<iframe src="${g}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen></iframe>`,cache_age:86400},S=`<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n    <oembed>\n      <version>1.0</version>\n      <type>rich</type>\n      <title>${p}</title>\n      <url>${g}</url>\n      <author_name>${y}</author_name>\n      <provider_name>${i.PRODUCT_NAME}</provider_name>\n      <provider_url>${new URL(g).origin}</provider_url>\n      <width>800</width>\n      <height>600</height>\n      <thumbnail_url>${d}</thumbnail_url>\n      <thumbnail_height>${c.height}</thumbnail_height>\n      <thumbnail_width>${c.width}</thumbnail_width>\n      <html><iframe src="${g}" width="800" height="600" scrolling="yes" frameborder="0" allowfullscreen="true"></iframe></html>\n      <cache_age>86400</cache_age>\n    </oembed>\n    `;return await Promise.all([w({authManager:e,config:i,isDataLossAllowed:s,isPublished:!0,itemDetails:n,itemResourcesEditInfo:r,resourceName:"oembed.json",resource:(0,m.ds)(f)}),w({authManager:e,config:i,isDataLossAllowed:s,isPublished:!0,itemDetails:n,itemResourcesEditInfo:r,resourceName:"oembed.xml",resource:new Blob([S],{type:"text/xml"})})]),{xml:S,json:f}})({authManager:e,config:i,fallbackThumbnailUrl:a,isDataLossAllowed:s,itemId:n.id,itemResourcesEditInfo:o}),N.Z.trackEvent(N.Z.Category.Story,N.Z.Action.Story_ShareStory,d.access),await Promise.all([...k,...O,...B])};var M=i(77468),U=i(30858);const k=async t=>{let{appVersion:e,authManager:i,config:s,isDataLossAllowed:r,isDuplicateCleanup:n,itemData:c,itemDetails:u,itemDraftData:h,itemResourcesEditInfo:p,itemResourceIdsToKeep:g,mode:f,storeBackup:S,type:b}=t;var I;const v=`draft_${Date.now()}.json`,P=(null===(I=u.typeKeywords)||void 0===I?void 0:I.filter((t=>!t.match(o.draft)&&t!==D.Zv)))??[];P.push(`${o.draft}:${e}`),u.typeKeywords=P,(t=>{let{mode:e,itemDetails:i,itemDraftData:s}=t;if(e!==a.PUBLISHING&&e!==a.UNPUBLISHING&&(0,M.Ot)(i)!==U.PC.draft)return i;if("object"===typeof s.nodes){const t=s,e=(()=>{for(const i of Object.values(t.nodes)){var e;if("tour"===i.type&&"guided-tour"===(null===(e=i.data)||void 0===e?void 0:e.type))return!0}return!1})(),a=(i.typeKeywords??[]).filter((t=>t!==D.Vk));e&&a.push(D.Vk),i.typeKeywords=a}})({mode:f,itemDetails:u,itemDraftData:h});try{var _;null===(_=S)||void 0===_||_()}catch{}u.typeKeywords=(0,M.TQ)({typeKeywords:u.typeKeywords,typeKeywordId:D.ss}),u.typeKeywords=(0,M.jT)({typeKeywords:u.typeKeywords,typeKeywordId:D.W2,data:v});const R=await w({authManager:i,itemDetails:u,config:s,isPublished:!1,isAdd:!0,isDataLossAllowed:r,itemResourcesEditInfo:p,resourceName:v,resource:(0,m.ds)(h)}),E=u.thumbnail instanceof Blob;if(await(0,d.WY)(`${(0,y.Zl)(s.PORTAL_HOST,i)}/content/users/${u.owner}/items/${u.id}/update\n  `,{authentication:i,params:{...u,...E?{thumbnail:u.thumbnail}:{},text:f===a.PUBLISHING||f===a.UNPUBLISHING?c:void 0}}),E){const{thumbnail:t}=await(0,l.rV)(u.id,{authentication:i});u.thumbnail=t}return{draftData:R,itemDetails:u,updateResources:await x({authManager:i,config:s,draftResourceId:v,isDataLossAllowed:r,isDuplicateCleanup:n,itemDetails:u,itemData:c,itemDraftData:h,itemResourcesEditInfo:p,itemResourceIdsToKeep:g,mode:f,type:b}),itemDraftData:h,itemData:c}},O=(t,e)=>[...e.filter((t=>t!==U.PC.draft&&t!==U.PC.published&&t!==U.PC.unpublishedChanges&&"status:draft"!==t&&"status:published"!==t&&"status:unpublished-changes"!==t)),t],B=(t,e)=>{var i;const a=(0,M._$)({typeKeywords:t.typeKeywords,typeKeywordId:s.firstPublishedDate}),r=(0,M._$)({typeKeywords:t.typeKeywords,typeKeywordId:s.publishedDate}),n=Date.now(),l=(null===(i=t.typeKeywords)||void 0===i?void 0:i.filter((t=>!t.match(s.publishedDate)&&!t.match(o.published)&&!t.match(D.sO))))??[];return l.push(`${s.publishedDate}:${n}`),l.push(`${o.published}:${e}`),a||r||l.push(`${s.firstPublishedDate}:${n}`),O(U.PC.published,l)},$=t=>{var e;const i=(null===(e=t.typeKeywords)||void 0===e?void 0:e.filter((t=>!t.match(s.publishedDate)&&!t.match(s.firstPublishedDate)&&!t.match(o.published)&&!t.match("Copy Item")&&!t.match(D.L3))))??[];return O(U.PC.draft,i)};var H=i(62056),j=i(23038),F=i(21707),G=i(58697),K=i(55098),V=i(23325),J=i(20868),W=i(32338),z=i(36871),q=i(66865),Y=i(34879),Q=i(63789);var X=i(96934),tt=i(57105);var et=i(28587),it=i(66831),at=i(4628);const st=t=>`smdraftrecovery_${t}`,ot=t=>{const e=st(t),i=window.localStorage.getItem(e);return JSON.parse(i)},rt=Object.freeze({[Q.o.Story]:N.Z.Category.Story,[Q.o.Collection]:N.Z.Category.Collection,[Q.o.Theme]:N.Z.Category.Theme,[Q.o.Briefing]:N.Z.Category.Briefing}),nt=Object.freeze({[Q.o.Story]:N.Z.Action.Story_UnpublishStory,[Q.o.Collection]:N.Z.Action.Collection_UnpublishCollection,[Q.o.Theme]:N.Z.Action.Theme_UnpublishTheme,[Q.o.Briefing]:N.Z.Action.Briefing_UnpublishBriefing}),lt=Object.freeze({[Q.o.Story]:N.Z.Action.Story_DuplicateStory,[Q.o.Collection]:N.Z.Action.Collection_DuplicateCollection,[Q.o.Theme]:N.Z.Action.Theme_DuplicateTheme,[Q.o.Briefing]:N.Z.Action.Briefing_DuplicateBriefing});var dt,ct;!function(t){t[t.DRAFT_SAVE=0]="DRAFT_SAVE",t[t.PUBLISHING=1]="PUBLISHING",t[t.UNPUBLISHING=2]="UNPUBLISHING",t[t.DISCARDING_UNPUBLISHED_CHANGES=3]="DISCARDING_UNPUBLISHED_CHANGES"}(dt||(dt={})),function(t){t.DRAFT="draft",t.PUBLISHED="published"}(ct||(ct={}));class ut extends at.jI{static#t=(()=>{this.fetchItemDraftData=async t=>{try{let a=await(0,p.jH)({itemDetails:t.itemDetails,portalHost:t.portalHost,authManager:t.authManager});if(t.type===Q.o.Collection&&a.items){var e;const{convertToNewCollectionsDataSchema:s}=await i.e(92251).then(i.bind(i,92251));a=await s(a,t.portalHost,(null===(e=t.config)||void 0===e?void 0:e.COLLECTION_ITEM_LIMIT)||K.E5,t.authManager)}if(ut.validateItemData(t.type,a))return{itemData:a,itemDataVersion:"draft"};throw{itemData:a,itemDataVersion:"draft"}}catch(a){if((0,u.ZX)(t.itemDetails)){return{itemData:await ut.fetchPublishedItemData({type:t.type,itemId:t.itemDetails.id,authManager:t.authManager,portalHost:t.portalHost,onlyReturnPublishedDataJsonResource:!0}),itemDataVersion:"published"}}if(404===a.code){const e=ot(t.itemDetails.id),i=new et.z(t.itemDetails.id,e&&e.data?e&&e.data:void 0);throw N.Z.trackEvent(N.Z.Category.Error,N.Z.Action.Error_DraftDataMissing,t.trackRecoveryMode?N.Z.Name.Draft_Recovery:void 0),i}throw a}}})();constructor(t){var e;super(t),e=this,this.itemDraftDataJSON="",this.isPublishWorkflowLocked=!1,this.itemResourcesEditInfo={},this.trackThirdPartyAppEditorApp=()=>{const t=(0,M.W$)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:D.ss})[0];t&&N.Z.trackEvent(N.Z.Category.ThirdParty,this.type+N.Z.Action.ThirdParty_Edited,t)},this.trackThirdPartyPubliserApp=()=>{const t=(0,M.W$)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:D.sO})[0];t&&N.Z.trackEvent(N.Z.Category.ThirdParty,this.type+N.Z.Action.ThirdParty_Published,t)},this.isDataLossAllowed=!1,this.isDataRecoveryPendingReview=!1,this.getItemPublishDate=()=>this.getItemPublishStatus()===U.PC.published&&super.getItemPublishDate(),this.setItemResourceIdsToKeep=t=>{this.itemResourceIdsToKeep=new Set(t)},this.upsertItemResource=t=>{const e=async()=>{try{return await w({...t,authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo})}catch(i){if(i instanceof b)return await this.handleDataLossWarning(i.resourceProperties),this.isDataLossAllowed?e():{success:!1};throw new Error}};return e()},this.confirmDataLossBeforeSave=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{await _({authManager:e.authManager,config:e.config,currentResourceProperties:t.currentResourceProperties,isDataLossAllowed:e.isDataLossAllowed,itemDetails:e.itemDetails,itemResourcesEditInfo:e.itemResourcesEditInfo,resourceName:t.resourceName})}catch(i){if(!(i instanceof b))throw i;await e.handleDataLossWarning(i.resourceProperties)}},this.addPendingItemRequest=t=>{const e=(0,S.fF)(this.pendingItemRequests).then(t);return this.pendingItemRequests=e,e},this.shareStory=t=>this.addPendingItemRequest((async()=>{var e;const i=rt[this.type];N.Z.trackEvent(i,N.Z.Action.Story_ShareStory,(null===(e=t)||void 0===e?void 0:e.access)??this.itemSharingLevel.access);const a=await C({authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,X.Zr)(this.config.BASE_URL)}`,isDataLossAllowed:this.isDataLossAllowed,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,sharingLevel:t??this.itemSharingLevel,type:this.type});return this.emit("share-end",a),a})),this.saveDraft=()=>this.addPendingItemRequest((async()=>{if(!this.isDataRecoveryPendingReview)try{this.emit("story-save-start"),this.trackThirdPartyAppEditorApp(),await this.updateDataAndDetails(dt.DRAFT_SAVE);const{draftData:t,itemDetails:e,updateResources:i}=await(t=>{let{itemDetails:e,...i}=t;return(0,M.Ot)(e)===U.PC.published&&(e.typeKeywords=O(U.PC.unpublishedChanges,e.typeKeywords??[])),k({...i,itemDetails:e,mode:a.DRAFT_SAVE})})({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,itemData:this.itemData,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo,itemResourceIdsToKeep:this.itemResourceIdsToKeep,storeBackup:this.storeBackup,type:this.type});this.setItemDetails(e),this.onSaveEnd(void 0,[t,e,i])}catch(t){t instanceof b&&(await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&this.saveDraft())}})),this.setTopicTags=t=>{var e;if(!(null===(e=t)||void 0===e?void 0:e.length))return void this.removeTopicTags();const i=(0,M.jT)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:D.L3,data:t});this.setItemDetails({...this.itemDetails,typeKeywords:i})},this.removeTopicTags=()=>{this.setItemDetails({...this.itemDetails,typeKeywords:(0,M.TQ)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:D.L3})})},this.publishStory=()=>this.addPendingItemRequest((async()=>{if(this.onPublishMethodStart(dt.PUBLISHING))try{var t;await this.emitBeforePublish((t=>this.emit("publishStatusUpdate",t))),this.emit("story-save-start");const e=this.getItemPublishStatus()===U.PC.draft;await this.updateDataAndDetails(dt.PUBLISHING);const{draftData:i,itemDetails:s,updateResources:o,serverItemData:r,shareItem:n,itemDraftData:l}=await(async t=>{let{appVersion:e,authManager:i,config:s,fallbackThumbnailUrl:o,isDataLossAllowed:r,isDuplicateCleanup:n,itemDetails:l,itemDraftData:d,itemResourcesEditInfo:c,sharingLevel:u,storeBackup:h,type:p}=t;l.typeKeywords=B(l,e);const g=await k({appVersion:e,authManager:i,config:s,isDataLossAllowed:r,isDuplicateCleanup:n,itemDetails:l,itemData:d,itemDraftData:d,itemResourcesEditInfo:c,mode:a.PUBLISHING,storeBackup:h,type:p}),y=await C({authManager:i,config:s,fallbackThumbnailUrl:o,itemDetails:l,isDataLossAllowed:r,itemResourcesEditInfo:c,sharingLevel:u,type:p});return{...g,serverItemData:await w({authManager:i,config:s,isAdd:!0,isDataLossAllowed:r,isPublished:!0,itemDetails:l,itemResourcesEditInfo:c,resourceName:f.f,resource:(0,m.ds)(d)}),shareItem:y}})({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,X.Zr)(this.config.BASE_URL)}`,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo,sharingLevel:this.itemSharingLevel,storeBackup:this.storeBackup,type:this.type});this.trackThirdPartyPubliserApp(),this.setItemDetails(s),this.setItemData(l),this.onSaveEnd(void 0,[i,s,o]);const d=[[i,s,o],n,r],c=(await(null===(t=this.authManager)||void 0===t?void 0:t.getUser())).userLicenseTypeId;(t=>{try{const e={[Q.o.Story]:N.Z.Category.Story,[Q.o.Frame]:N.Z.Category.Frame,[Q.o.Briefing]:N.Z.Category.Briefing,[Q.o.Collection]:N.Z.Category.Collection,[Q.o.Theme]:N.Z.Category.Theme}[t.type],i={[Q.o.Story]:N.Z.Category.StoryStatistics,[Q.o.Frame]:N.Z.Category.FrameStatistics,[Q.o.Briefing]:N.Z.Category.BriefingStatistics,[Q.o.Collection]:N.Z.Category.CollectionStatistics,[Q.o.Theme]:N.Z.Category.ThemeStatistics}[t.type],a={[Q.o.Story]:N.Z.Action.Story_PublishStory,[Q.o.Frame]:N.Z.Action.Frame_PublishFrame,[Q.o.Briefing]:N.Z.Action.Briefing_PublishBriefing,[Q.o.Collection]:N.Z.Action.Collection_PublishCollection,[Q.o.Theme]:N.Z.Action.Theme_PublishTheme}[t.type];if(N.Z.trackEvent(e,a,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish),t.firstPublish){let i,{licenseType:a}=t;a||(a=""),i=a.includes("creator")?N.Z.Name.Story_PublishStory_UserType_Creator:a.includes("GISProfessional")?N.Z.Name.Story_PublishStory_UserType_GISProfessional:a.includes("Storyteller")?N.Z.Name.Story_PublishStory_UserType_StoryTeller:N.Z.Name.Story_PublishStory_UserType_Public,N.Z.trackEvent(e,N.Z.Action.Story_PublishStory_UserType,i)}const s=new Date;if(t.firstPublish?N.Z.trackEvent(i,N.Z.Action.StoryStatistics_FirstPublish_DayOfMonth,s.getDate().toString()):N.Z.trackEvent(i,N.Z.Action.StoryStatistics_Republish_DayOfMonth,s.getDate().toString()),N.Z.trackEvent(N.Z.Category.StoryStatistics,(0,u.fW)(t.itemDetails)?N.Z.Action.ItemStatistics_AllowPublishedDuplicate:N.Z.Action.ItemStatistics_DoNotAllowPublishedDuplicate,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish),N.Z.trackEvent(N.Z.Category.StoryStatistics,(0,u._$)(t.itemDetails)?N.Z.Action.ItemStatistics_OptIntoSEO:N.Z.Action.ItemStatistics_OptOutOfSEO,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish),"story"===t.type){const e={};let i=0,a=0;Object.keys(t.itemData.nodes).forEach((s=>{const o=t.itemData.nodes[s];if("immersive-slide"!==o.type&&"immersive-side-panel"!==o.type){if("immersive"===o.type){let t=o.data.type;"sidecar"===t&&(t="floating-panel"===o.data.subtype?"sidecar-float":"docked-panel"===o.data.subtype?"sidecar-docked":"sidecare-slideshow"),o.type=t}else if("gallery"===o.type){const t=()=>"square-dynamic"===o.data.galleryLayout?"gallery-square-dynamic":"jigsaw"===o.data.galleryLayout?"gallery-jigsaw":"gallery-filmstrip";o.type=t()}var r,n;if("number"===typeof e[o.type]?e[o.type]=e[o.type]+1:e[o.type]=1,("image"===o.type||"video"===o.type||"audio"===o.type||"embed"===o.type||"expressmap"===o.type||"thematic-map"===o.type||"webmap"===o.type||"swipe"===o.type)&&(i+=1,(null===(n=o.data)||void 0===n||null===(r=n.alt)||void 0===r?void 0:r.length)>0&&(a+=1)),!o.data||"slideshow"!==o.type&&"sidecar-float"!==o.type&&"sidecar-docked"!==o.type||(o.data.type,N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_SideCar_FirstPublish_SlidesCount:N.Z.Action.StoryStatistics_SideCar_Republish_SlidesCount,N.Z.Name.Builder_Sidecar,o.children?o.children.length:0)),"table"===o.type&&o.data){const{numRows:e,numColumns:i}=o.data;N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_Table_FirstPublish_NumRows:N.Z.Action.StoryStatistics_Table_Republish_NumRows,N.Z.Name.Builder_Table,e),N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_Table_FirstPublish_NumColumns:N.Z.Action.StoryStatistics_Table_Republish_NumColumns,N.Z.Name.Builder_Table,i)}if("tour"===o.type&&o.data){const e="explorer"===o.data.type;N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?e?N.Z.Action.StoryStatistics_Explorer_FirstPublish_SlidesCount:N.Z.Action.StoryStatistics_GuidedTour_FirstPublish_SlidesCount:e?N.Z.Action.StoryStatistics_Explorer_Republish_SlidesCount:N.Z.Action.StoryStatistics_GuidedTour_Republish_SlidesCount,e?N.Z.Name.Builder_Explorer:N.Z.Name.Builder_GuidedTour,o.data.places?o.data.places.length:0);let i="";switch(o.data.subtype){case"map-focused":i="Map_Focused";break;case"media-focused":i="Media_Focused";break;case"list":i="List";break;case"grid":i="Grid"}N.Z.trackEvent(N.Z.Category.StoryStatistics,e?N.Z.Action.StoryStatistics_Explorer_Layout:N.Z.Action.StoryStatistics_GuidedTour_Layout,i)}if("credits"===o.type&&o.config&&!o.config.isHidden&&N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_CreditsToggledOn:N.Z.Action.StoryStatistics_Republish_CreditsToggledOn),"story"===o.type){var l,d,c,u;if((null===(l=o.config)||void 0===l?void 0:l.storyLocale)&&N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_StoryLocale:N.Z.Action.StoryStatistics_Republish_StoryLocale,o.config.storyLocale),null===(d=o.config)||void 0===d?void 0:d.analytics){const e=o.config.analytics.type;N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_AuthorAnalytics:N.Z.Action.StoryStatistics_Republish_AuthorAnalytics,e)}(null===(c=o.config)||void 0===c?void 0:c.isSocialIconsHidden)&&N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_HideSocialShare:N.Z.Action.StoryStatistics_Republish_HideSocialShare),N.Z.trackEvent(N.Z.Category.StoryStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_CoverDate:N.Z.Action.StoryStatistics_Republish_CoverDate,null===(u=o.config)||void 0===u?void 0:u.coverDate)}}}));const s=t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_NodeCount:N.Z.Action.StoryStatistics_Republish_NodeCount;Object.keys(e).forEach((t=>{N.Z.trackEvent(N.Z.Category.StoryStatistics,s,t,e[t])}));const o=t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_AltTextUsed:N.Z.Action.StoryStatistics_Republish_AltTextUsed,r=i>0&&a>0,n=Math.round(a/i*100);N.Z.trackEvent(N.Z.Category.StoryStatistics,o,r.toString(),n)}if(t.type===Q.o.Theme){const{resources:e,titleFont:i,bodyFont:a,variables:s}=t.itemData,o={title:{action:t.firstPublish?N.Z.Action.ThemeStatistics_FirstPublish_TitleFont:N.Z.Action.ThemeStatistics_Republish_TitleFont,themeVariablesFontId:s.titleFontId},body:{action:t.firstPublish?N.Z.Action.ThemeStatistics_FirstPublish_BodyFont:N.Z.Action.ThemeStatistics_Republish_BodyFont,themeVariablesFontId:s.bodyFontId}};(i=>{const a={google:0};i.forEach((t=>{var i;const{type:s,data:r}=t,n=o[s];if((0,Y.ed)(n.themeVariablesFontId))return void N.Z.trackEvent(N.Z.Category.ThemeStatistics,n.action,q.s[n.themeVariablesFontId].displayName);if(!r)return;const l=null===(i=e)||void 0===i?void 0:i[r.resource].data;l&&(a[l.provider]++,N.Z.trackEvent(N.Z.Category.ThemeStatistics,n.action,l.displayName))})),a.google&&N.Z.trackEvent(N.Z.Category.ThemeStatistics,t.firstPublish?N.Z.Action.ThemeStatistics_FirstPublish_UsedGoogleFonts:N.Z.Action.ThemeStatistics_Republish_UsedGoogleFonts)})([{type:"title",data:i},{type:"body",data:a}])}if(t.type===Q.o.Collection&&Object.keys(t.itemData.nodes).forEach((e=>{const i=t.itemData.nodes[e];if("collection-cover"===i.type){var a,s,o;const e=i.children?null===(a=i.children)||void 0===a?void 0:a.reduce(((e,i)=>{const a=t.itemData.nodes[i];if("text"===a.type){const t=a.data.text,i=(0,H.dW)(t??"");return{nodeCount:e.nodeCount+1,characterCount:e.characterCount+i.length}}return e}),{nodeCount:0,characterCount:0}):{nodeCount:0,characterCount:0};N.Z.trackEvent(N.Z.Category.CollectionStatistics,N.Z.Action.Collection_Description_TextBlocks,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish,null===(s=e)||void 0===s?void 0:s.nodeCount),N.Z.trackEvent(N.Z.Category.CollectionStatistics,N.Z.Action.Collection_Description_CharacterCount,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish,null===(o=e)||void 0===o?void 0:o.characterCount)}})),"briefing"===t.type){const e={},i={},a={},s={},o={},r={};Object.keys(t.itemData.nodes).forEach((n=>{const l=t.itemData.nodes[n];if(e[l.type]=e[l.type]+1||1,"briefing-slide"===l.type){const e=l,s=e.data.sublayout?e.data.layout+":"+e.data.sublayout:e.data.layout,o=e.data.contents;if(i[s]=i[s]+1||1,e.data.title){var d,c;const i=null===(c=t.itemData.nodes[e.data.title])||void 0===c||null===(d=c.data)||void 0===d?void 0:d.text.length;N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedSlideTitleLength,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish,i)}o&&Object.keys(o).forEach((e=>{const i=o[e];if(Array.isArray(i))i.forEach((e=>{const i=t.itemData.nodes[e].type;if(r[s]?r[s][i]=r[s][i]+1||1:r[s]={[i]:1},r[s]={contentNodeType:r[s][i]+1||1},"text"===i){const i=t.itemData.nodes[e].data.type;a[i]=a[i]+1||1}}));else{const e=t.itemData.nodes[i].type;if(r[s]?r[s][e]=r[s][e]+1||1:r[s]={[e]:1},"text"===e){const e=t.itemData.nodes[i].data.type;a[e]=a[e]+1||1}}}))}if("storycover"===l.type&&l.children){const e=l.children[0],i=t.itemData.nodes[e].type;N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_CoverMediaType,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish,0,i)}if("image"===l.type||"video"===l.type){const t=l.type,e=l.config&&l.config.placement?l.config.placement.type:"fill";"image"===t&&(s[e]=s[e]+1||1),"video"===t&&(o[e]=o[e]+1||1)}}),Object.keys(t.itemData.resources).forEach((e=>{const i=t.itemData.resources[e];if("story-theme"===i.type){const e=i.data.themeItemId?"custom":i.data.themeId;N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BreifingStatistics_PublishedTheme,e,0,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)}}))),Object.keys(e).forEach((i=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,t.firstPublish?N.Z.Action.StoryStatistics_FirstPublish_NodeCount:N.Z.Action.StoryStatistics_Republish_NodeCount,i,e[i])})),Object.keys(i).forEach((e=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedSlideLayoutCount,e,i[e],t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)})),Object.keys(r).forEach((e=>{Object.keys(r[e]).forEach((i=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedSlideLayoutContentCount,e,r[e][i],i,t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)}))})),Object.keys(a).forEach((e=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedTextTypeCount,e,a[e],t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)})),Object.keys(s).forEach((e=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedImagePlacementCount,e,s[e],t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)})),Object.keys(o).forEach((e=>{N.Z.trackEvent(N.Z.Category.BriefingStatistics,N.Z.Action.BriefingStatistics_PublishedVideoPlacementCount,e,o[e],t.firstPublish?N.Z.Name.Story_PublishStory_FromDraft:N.Z.Name.Story_PublishStory_Republish)}))}}catch{return}})({type:this.type,itemDetails:this.itemDetails,itemData:this.itemData,firstPublish:e,licenseType:c}),this.onPublishMethodEnd(dt.PUBLISHING,[e,null,d])}catch(e){if(!(e instanceof b))throw this.onPublishMethodEnd(dt.PUBLISHING,[!1,e]),new Error(e);await this.handleDataLossWarning(e.resourceProperties),this.isDataLossAllowed&&this.publishStory()}})),this.discardUnpublishedChanges=()=>this.addPendingItemRequest((async()=>{if(this.onPublishMethodStart(dt.DISCARDING_UNPUBLISHED_CHANGES))try{this.emit("story-save-start"),await this.updateDataAndDetails(dt.DISCARDING_UNPUBLISHED_CHANGES);const{draftData:t,itemDetails:e,updateResources:i}=await(t=>{let{itemDetails:e,...i}=t;return e.typeKeywords=O(U.PC.published,e.typeKeywords??[]),k({...i,itemDetails:e,itemDraftData:i.itemData,mode:a.DISCARDING_UNPUBLISHED_CHANGES})})({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,itemData:this.itemData,itemDetails:this.itemDetails,isDataLossAllowed:this.isDataLossAllowed,itemResourcesEditInfo:this.itemResourcesEditInfo,storeBackup:this.storeBackup,type:this.type});this.setItemDraftData(this.itemData),this.setItemDetails(e);const s=[t,e,i];this.onSaveEnd(void 0,[s]),N.Z.trackEvent(rt[this.type],N.Z.Action.Story_DiscardUnpublishedChanges),this.onPublishMethodEnd(dt.DISCARDING_UNPUBLISHED_CHANGES,[s])}catch(t){if(!(t instanceof b))throw this.onPublishMethodEnd(dt.DISCARDING_UNPUBLISHED_CHANGES,[null,t]),new Error(t);await this.handleDataLossWarning(t.resourceProperties),this.isDataLossAllowed&&await this.discardUnpublishedChanges()}})),this.unpublishStory=t=>this.addPendingItemRequest((async()=>{if(this.onPublishMethodStart(dt.UNPUBLISHING))try{this.emit("story-save-start"),await this.updateDataAndDetails(dt.DISCARDING_UNPUBLISHED_CHANGES),t&&this.type===Q.o.Theme&&(this.itemDraftData.title=this.itemDetails.title);const{draftData:e,itemDetails:i,updateResources:s,shareItem:o,itemData:r}=await(async t=>{const{authManager:e,config:i,fallbackThumbnailUrl:s,isDataLossAllowed:o,itemDetails:r,itemResourcesEditInfo:n,sharingLevel:l,type:d}=t;return r.typeKeywords=$(r),{...await k({...t,itemData:{unpublished:!0},mode:a.UNPUBLISHING}),shareItem:await C({authManager:e,config:i,itemDetails:r,isDataLossAllowed:o,fallbackThumbnailUrl:s,sharingLevel:l,itemResourcesEditInfo:n,type:d})}})({appVersion:this.config.APP_VERSION,authManager:this.authManager,config:this.config,fallbackThumbnailUrl:`${location.origin}${(0,X.Zr)(this.config.BASE_URL)}`,itemDetails:this.itemDetails,itemDraftData:this.itemDraftData,isDataLossAllowed:this.isDataLossAllowed,isDuplicateCleanup:!0,itemResourcesEditInfo:this.itemResourcesEditInfo,storeBackup:this.storeBackup,type:this.type,sharingLevel:V.v});this.setItemData(r),this.setItemDetails(i),this.itemSharingLevel=V.v,this.onSaveEnd(void 0,[e,i,s]);const n=[[e,i,s],o];t||N.Z.trackEvent(rt[this.type],nt[this.type]),this.onPublishMethodEnd(dt.UNPUBLISHING,[n])}catch(e){if(!(e instanceof b))throw this.onPublishMethodEnd(dt.UNPUBLISHING,[null,e]),new Error(e);await this.handleDataLossWarning(e.resourceProperties),this.isDataLossAllowed&&this.unpublishStory()}})),this.hasUnsavedChanges=async()=>this.itemDraftDataJSON!==JSON.stringify((await this.getStoryData(dt.DRAFT_SAVE)).itemData),this.setGetStoryDataMethod=t=>{this.getStoryData=t},this.setGenerateStoryItemUrlMethod=t=>{this.generateStoryItemUrl=t},this.setEmitBeforePublish=t=>{this.emitBeforePublish=t},this.setConfirmDataLossMethod=t=>{this.confirmDataLoss=t},this.setConfirmAdminAction=t=>{this.confirmAdminAction=t},this.fetchStoryBuilderData=async()=>{var t;const e={itemId:this.itemId,authManager:this.authManager,portalHost:this.config.PORTAL_HOST},i={...e,type:this.type},a=await ut.fetchItemDetails(e);if("update"!==a.itemControl&&"admin"!==a.itemControl&&!a.origin)throw new z.Z({type:"story-privileges-edit",itemType:this.type});if(this.setItemDetails(a),a.origin)throw new z.Z({type:"distributed-collab-no-draft"});const s=await(0,u.mY)({itemDetails:this.itemDetails,authManager:this.authManager,excludeFavoritesGroup:!0});this.itemSharingLevel={access:this.itemDetails.access,groups:s,isUnlisted:(null===(t=this.itemDetails.typeKeywords)||void 0===t?void 0:t.includes(D.L7))??!1};let o="draft";try{const{itemData:t,itemDataVersion:e}=await ut.fetchItemDraftData({itemDetails:this.itemDetails,type:this.type,authManager:this.authManager,portalHost:this.config.PORTAL_HOST,trackRecoveryMode:!0});this.setItemDraftData(t),o=e}catch(r){if(!(0,et.T)(r))throw r;this.isDataRecoveryPendingReview=!0,this.setItemDraftData(r.recoveryDraftData)}if(await P({authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,resourceName:"draft.json"}),this.getItemPublishStatus()!==U.PC.draft){const t=await ut.fetchPublishedItemData(i);this.setItemData(t)}return o},this.isStoryOwner=async()=>{var t,e;return(null===(e=await(null===(t=this.authManager)||void 0===t?void 0:t.getUser()))||void 0===e?void 0:e.username)===this.itemOwner},this.duplicateStory=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"draft";if(!(await(0,W.W)(e.type,e.authManager,e.storyMapUserPrivileges)))throw new Error(K.Eo);const i=`${(0,y.Zl)(e.config.PORTAL_HOST,e.authManager)}/content/users/${e.itemOwner}/items/${e.itemId}/copy`,a=await(0,d.WY)(i,{authentication:e.authManager,httpMethod:"POST",params:{includeResources:!0,copyPrivateResources:"draft"===t,f:"json"}});N.Z.trackEvent(rt[e.type],lt[e.type],"published"===t?N.Z.Name.ItemStatistics_DuplicatePublishedStory:N.Z.Name.Builder_Common_Duplicate);const s={itemId:a.itemId,authManager:e.authManager,portalHost:e.config.PORTAL_HOST},o={maxRetries:60,delay:5e3};if("published"===t)await(0,S.Up)(at.jI.fetchPublishedItemData,{promiseArguments:[{...s,type:e.type,onlyReturnPublishedDataJsonResource:!0}],...o});else{const t=await ut.fetchItemDetails(s);await(0,S.Up)(p.jH,{promiseArguments:[{itemDetails:t,portalHost:e.config.PORTAL_HOST,authManager:e.authManager}],...o})}return a},this.duplicateStoryCleanup=async(t,e)=>{const i=`${t} `;if(this.itemDetails.title){const t=(0,H.E)({stringModifier:i,originalString:this.itemDetails.title,maxLength:T.e4});await(0,l.$G)({item:{id:this.itemId,title:t},authentication:this.authManager})}return await this.emitAfterDuplication(i,e),await this.unpublishStory(!0)},this.fetchItemResource=async t=>{let{skipEditInfoTracking:e,...i}=t;const a=await super.fetchItemResource(i);return e||await P({authManager:this.authManager,config:this.config,itemDetails:this.itemDetails,itemResourcesEditInfo:this.itemResourcesEditInfo,resourceName:i.resourceName}),a},this.getItemFirstPublishDate=()=>this.getItemPublishStatus()===U.PC.published&&super.getItemFirstPublishDate(),this.autosaveStory=(0,S.e2)(this.saveDraft,{debounceTime:1e3,throttleTime:1e4,confirmBeforeUnload:!0,onImmediateCallback:t=>{this.removePristineTypeKeyword(),this.isPublishWorkflowLocked?t("Cancel: pending publish"):this.cancelPendingAutosave=t}}),this.emitAfterDuplication=(t,e)=>Promise.resolve(),this.setEmitAfterDuplication=t=>{this.emitAfterDuplication=t},this.onSaveEnd=(t,e,i)=>{window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent),this.emit("story-save-end",t,e,i)},this.getPublishEventName=t=>{switch(t){case dt.PUBLISHING:return"story-publish";case dt.DISCARDING_UNPUBLISHED_CHANGES:return"discard-unpublished-changes";default:return"story-unpublish"}},this.onPublishMethodStart=t=>{var e;return!this.isPublishWorkflowLocked&&!this.isDataRecoveryPendingReview&&(null===(e=this.cancelPendingAutosave)||void 0===e||e.call(this,"Cancel: Publish method started"),this.isPublishWorkflowLocked=!0,this.emit(`${this.getPublishEventName(t)}-start`),window.addEventListener("beforeunload",this.defaultWindowUnloadEvent),!0)},this.onPublishMethodEnd=(t,e)=>{this.isPublishWorkflowLocked=!1,this.emit(`${this.getPublishEventName(t)}-end`,...e),this.emit("publish-method-end"),window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent)},this.onDataOverwriteRejected=()=>{window.removeEventListener("beforeunload",this.defaultWindowUnloadEvent),this.emit("DATA_OVERWRITE_REJECTED")},this.getStoryData=async t=>({itemDetails:{},itemData:{root:"",nodes:{},resources:{}}}),this.generateStoryItemUrl=()=>{throw new Error("Generate-url function not provided")},this.emitBeforePublish=t=>Promise.resolve(),this.updateDataAndDetails=async t=>{const e=await this.getStoryData(t);if("undefined"===typeof e)throw new Error("Story data not getting updated.");if(t!==dt.PUBLISHING&&t!==dt.DRAFT_SAVE||this.setItemDraftData(e.itemData),t===dt.PUBLISHING||t===dt.UNPUBLISHING||this.getItemPublishStatus()===U.PC.draft){const n={...this.itemDetails,...e.itemDetails};n.title||(n.title=(0,it.bH)({type:this.type,dateStamp:n.created})),this.type!==Q.o.Theme&&(t===dt.PUBLISHING?n.url=this.generateStoryItemUrl({route:"viewer",itemId:this.itemId,itemType:this.type}):t===dt.UNPUBLISHING&&(n.url=""));const l="undefined"===typeof e.shouldPushMetaToAGOItemDetails?G.R:e.shouldPushMetaToAGOItemDetails;if(await(async t=>{let{type:e,itemDetails:i,itemProperties:a,thumbnail:s,baseUrl:o,authManager:r,portalHost:n,shouldPushMetaToAGOItemDetails:l,shouldForceUpdateThumbnail:d}=t;if(e===Q.o.Story||e===Q.o.Collection||e===Q.o.Briefing){var c,u,m,p;const t=(0,j.G)(i),e=JSON.stringify((null===(c=t)||void 0===c?void 0:c.thumbnail)??null),g=JSON.stringify((null===(u=a)||void 0===u?void 0:u.thumbnail)??null),y="generated"===(null===(p=a)||void 0===p||null===(m=p.thumbnail)||void 0===m?void 0:m[0]),f=!!(y&&s instanceof Blob)||e!==g&&"null"!==e;if("null"===g&&(a={...a,thumbnail:["default"]}),f||d||!(i.thumbnailUrl||i.thumbnail instanceof Blob)||(delete i.thumbnailUrl,delete i.thumbnail),f||d){if(s instanceof Blob&&(i.thumbnail=s),!l)return;if(!y){const t=i.thumbnailUrl?await(0,h.ti)((0,tt.aU)(i.thumbnailUrl,{width:3e3,authManager:r,shouldIgnoreDPR:!0,portalHost:n}),{aspectRatio:1.5,zoom:5,quality:.8,type:"image/jpeg"}):await(0,X.mI)(o);i.thumbnail=t}delete i.thumbnailUrl}}else"undefined"===typeof s&&i.thumbnail instanceof Blob?delete i.thumbnail:s&&(i.thumbnail=s)})({type:this.type,itemDetails:n,itemProperties:e.properties,thumbnail:e.thumbnail,baseUrl:this.config.BASE_URL,authManager:this.authManager,portalHost:this.config.PORTAL_HOST,shouldPushMetaToAGOItemDetails:l,shouldForceUpdateThumbnail:e.hasShouldPushMetaToAGOItemDetailsChanged&&l}),l){var i,a,s,o,r;const t=null===(i=e.properties)||void 0===i?void 0:i.metaProperties;(null===(a=t)||void 0===a?void 0:a.title)&&(n.title=t.title),(null===(s=t)||void 0===s?void 0:s.description)&&(n.snippet=t.description),null===(o=e.properties)||void 0===o||delete o.metaProperties,null===(r=n.properties)||void 0===r||delete r.metaProperties}else delete n.title,delete n.snippet,delete n.description;e.properties&&(n.properties=(0,j.M)(e.properties,n)),n.clearEmptyFields=!0,this.setItemDetails(n)}},this.defaultWindowUnloadEvent=t=>{t.preventDefault(),t.returnValue=""},this.downloadDraftRecoveryFileFromConsole=()=>{((t,e)=>{try{{const i=st(t),a=ot(t);if(a&&(!e||!a.downloaded))return(0,m.Hy)(a.data,`StoryMap_Draft_Recovery_${t}`),window.localStorage.setItem(i,JSON.stringify({...a,downloaded:!0})),!0}}catch{}return!1})(this.itemId)||console.error("No draft recovery file available for download.")},this.storeBackup=()=>{try{const t={timestamp:Date.now(),downloaded:!1,data:this.itemDraftData};window.localStorage.setItem(st(this.itemId),JSON.stringify(t))}catch{}},this.handleDataLossWarning=async t=>{var e;if((null===(e=t)||void 0===e?void 0:e.editInfo)&&"function"===typeof this.confirmDataLoss){if(!(await this.confirmDataLoss(t.editInfo)))throw this.onDataOverwriteRejected(),new Error(K.J8);this.isDataLossAllowed=!0,setTimeout((()=>{this.isDataLossAllowed=!1}),5e3)}},this.removePristineTypeKeyword=()=>{var t;(null===(t=this.itemDetails.typeKeywords)||void 0===t?void 0:t.includes(D.Zv))&&this.setItemDetails({...this.itemDetails,typeKeywords:this.itemDetails.typeKeywords.filter((t=>t!==D.Zv))})},window.downloadDraftRecoveryFile=this.downloadDraftRecoveryFileFromConsole}get itemDraftData(){return this._itemDraftData}set itemDraftData(t){if(this._itemDraftData)throw new Error("Item draft data have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemDraftData(t)}updateAppVersion(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt.DRAFT_SAVE;const e=t===dt.PUBLISHING||t===dt.UNPUBLISHING?J.Nf.published:J.Nf.draft,i=(this.itemDetails.typeKeywords??[]).filter((t=>0!==t.search(e)));t===dt.UNPUBLISHING?this.setItemDetails({...this.itemDetails,typeKeywords:i}):this.setItemDetails({...this.itemDetails,typeKeywords:[...i,`${e}:${this.config.APP_VERSION}`]})}setItemPublishStatus(t){const e=O(t,this.itemDetails.typeKeywords??[]);this.setItemDetails({...this.itemDetails,typeKeywords:[...e]})}setItemFirstPublishDate(t){const e=(this.itemDetails.typeKeywords??[]).filter((t=>!t.match(J.i1.firstPublishedDate)));"remove"===t?this.setItemDetails({...this.itemDetails,typeKeywords:[...e]}):this.setItemDetails({...this.itemDetails,typeKeywords:[...this.itemDetails.typeKeywords??[],`${J.i1.firstPublishedDate}:${new Date(t).getTime()}`]})}setItemDraftData(t){const e=F.LN.sanitize(t,{allowUndefined:!0});this._itemDraftData=e,this.itemDraftDataJSON=JSON.stringify(e)}}var ht=ut},4628:function(t,e,i){i.d(e,{jI:function(){return b}});var a=i(22699),s=i(48206),o=i(69378),r=i(39613),n=i(73691),l=i(62056),d=i(23038),c=i(21707),u=i(79562),h=i(73927),m=i(77468),p=i(30858),g=i(16027),y=i(55098),f=i(23325),S=i(20868),D=i(63789);class b extends a.EventEmitter{static#t=(()=>{this.validateItemData=(t,e)=>{switch(t){case D.o.Briefing:case D.o.Collection:case D.o.Frame:case D.o.Story:return e&&"string"===typeof e.root;case D.o.Theme:return e&&"object"===typeof e;default:return!1}}})();static#e=(()=>{this.fetchItemDetails=async t=>{const e=t.authManager?t.authManager:void 0;return await(0,s.rV)(t.itemId,{authentication:e,portal:e?void 0:(0,r.Zl)(t.portalHost)})}})();static#i=(()=>{this.fetchPublishedItemData=async t=>{var e;let a=await(0,n.L)({itemId:t.itemId,authManager:t.authManager,portalHost:t.portalHost,language:t.language,onlyReturnPublishedDataJsonResource:t.onlyReturnPublishedDataJsonResource});if(t.type===D.o.Collection&&(null===(e=a)||void 0===e?void 0:e.items)){var s;const{convertToNewCollectionsDataSchema:e}=await i.e(92251).then(i.bind(i,92251));a=await e(a,t.portalHost,(null===(s=t.config)||void 0===s?void 0:s.COLLECTION_ITEM_LIMIT)||y.E5,t.authManager)}if(b.validateItemData(t.type,a))return a;const o=new Error(`invalid json response body at ${(0,r.Zl)(t.portalHost,t.authManager)}/content/items/${t.itemId}/data. reason: Unexpected end of JSON input`);throw o.name="FetchError",o.type="invalid-json",o}})();constructor(t){var e;super(),e=this,this._isOrgItem=!1,this._viewerMode="view",this.preloadedItemResourceImages={},this.getItemResourceUrl=(t,e)=>{const i=t.authManager||this.authManager,a=this.shouldItemResourceUseCDN(),s=t.queryParameters?Object.assign({},t.queryParameters):{};!t.skipToken&&!a&&i&&i.token&&(s.token=i.token);let o=`${t.sharingUrl??(0,r.Zl)(this.config.PORTAL_HOST)}/content/items/${e??this.itemId}/resources/${t.resourceName}${Object.keys(s).length?"?"+(0,l.qC)(s):""}`;if(a){const t=/^https:\/\/www.arcgis.com/;o=o.replace(t,"https://cdn.arcgis.com")}return o},this.preloadItemResourceImage=(t,e)=>{const i=this.getKeyForPreloadedItemResourceImage(t,e);return new Promise((a=>{if("undefined"!==typeof this.preloadedItemResourceImages[i])a({image:this.preloadedItemResourceImages[i],key:i,fileName:t,width:e});else{const s=new Image;s.src=this.getItemResourceImageFullUrl({imageFileName:t,width:e}),s.onload=()=>{this.preloadedItemResourceImages[i]=s,a({image:s,key:i,fileName:t,width:e})},s.onerror=i=>{a({error:i.error,fileName:t,width:e})}}}))},this.getSupportedTranslationLocales=()=>{var t;return Object.keys((null===(t=(0,d.G)(this.itemDetails))||void 0===t?void 0:t.translations)??{})},this.getOriginalStoryLocale=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"en-us";return e.itemDetails.culture??t},this.getKeyForPreloadedItemResourceImage=(t,e)=>`${t}_w${e}`,this._fetchItemResource=async t=>{const e=this.getItemResourceUrl({...t,skipToken:!0}),i=await(0,o.WY)(e,{authentication:this.authManager});return/\.json$/.test(t.resourceName)?c.LN.sanitize(i,{allowUndefined:!0}):i},this._type=t.type,this.config=t.config,this.version=t.version,t.authManager&&(this.authManager=t.authManager),this._getStoryMapUserPrivileges=t.getStoryMapUserPrivileges,t.viewerMode&&(this.viewerMode=t.viewerMode)}get itemId(){return this._itemId}set itemId(t){this._itemId||(this._itemId=t)}get type(){return this._type}get itemOwner(){return this._itemOwner}get itemDetails(){return this._itemDetails}set itemDetails(t){if(this._itemDetails)throw new Error("Item details have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemDetails(t)}get itemData(){return this._itemData}set itemData(t){if(this._itemData)throw new Error("Item data have already been set on the StoryItem and cannot be modified from outside of the StoryItem");this.setItemData(t)}get itemSharingLevel(){var t,e,i;return this._itemSharingLevel?this._itemSharingLevel.access===u.eJ.PRIVATE&&(null===(t=this._itemSharingLevel.groups)||void 0===t?void 0:t.length)&&(null===(e=this._itemSharingLevel.groups)||void 0===e?void 0:e.length)>0?{access:u.eJ.SHARED,groups:this._itemSharingLevel.groups,isUnlisted:!1}:this._itemSharingLevel:this.itemDetails&&this.itemDetails.access?{access:this.itemDetails.access,groups:[],isUnlisted:(null===(i=this.itemDetails.typeKeywords)||void 0===i?void 0:i.includes(h.L7))??!1}:f.v}set itemSharingLevel(t){this._itemSharingLevel=t}get selectedTopicTagIds(){const t=(0,m.c4)(this.itemDetails);return JSON.stringify(t)!==JSON.stringify(this._selectedTopicTagIds)&&(this._selectedTopicTagIds=t),this._selectedTopicTagIds}set version(t){this._itemVersion=t}get version(){return this._itemVersion}get isOrgItem(){return this._isOrgItem}set viewerMode(t){this._viewerMode=t}get viewerMode(){return this._viewerMode}get authManager(){return this._authManager}set authManager(t){!this.itemOwner&&t&&t.username&&(this._itemOwner=t.username),this._authManager=t}get storyMapUserPrivileges(){return this._getStoryMapUserPrivileges()}getItemPublishDate(){try{const t=(0,m.W$)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.i1.publishedDate})[0]||(0,m.W$)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:"publish-date"})[0];if(t)return new Date(parseInt(t,10));throw new Error("No published date")}catch{return"builder"!==this.viewerMode&&new Date(this.itemDetails?this.itemDetails.created:Date.now())}}getItemFirstPublishDate(){try{const t=(0,m.W$)({typeKeywords:this.itemDetails.typeKeywords,typeKeywordId:S.i1.firstPublishedDate})[0];if(t)return new Date(parseInt(t,10));throw new Error("No first published date")}catch{return"builder"!==this.viewerMode&&new Date(this.itemDetails?this.itemDetails.created:Date.now())}}getItemPublishStatus(){if("undefined"===typeof this.itemDetails)return p.PC.draft;const t=(0,m.Ot)(this.itemDetails);return t||p.PC.draft}getItemResourceImageFullUrl(t){let{imageFileName:e,width:i,itemId:a,shouldIgnoreDPR:s,sharingUrl:o}=t;if(!e)return"";if(e.startsWith("https://"))return e;const r=i&&(0,g.n)({width:i,fileName:e,shouldIgnoreDPR:s}),n={resourceName:e,authManager:void 0,sharingUrl:o,queryParameters:r?{w:r}:void 0};return this.getItemResourceUrl(n,a)}unloadPreloadedItemResourceImage(t,e){delete this.preloadedItemResourceImages[this.getKeyForPreloadedItemResourceImage(t,e)]}shouldItemResourceUseCDN(){return"view"===this.viewerMode&&"www.arcgis.com"===this.config.PORTAL_HOST&&this.itemSharingLevel.access===u.eJ.PUBLIC}fetchItemResource(t){return this._fetchItemResource(t)}setItemDetails(t){this._itemId=t.id,this._itemOwner=t.owner,this._itemDetails=t,(this._itemDetails.orgId||this._itemDetails.isOrgItem||0===(this._itemDetails.typeKeywords??[]).filter((t=>t===y.nt)).length)&&(this._isOrgItem=!0)}setItemData(t){const e=c.LN.sanitize(t,{allowUndefined:!0});this._itemData=e}}e.ZP=b},81020:function(t,e,i){i.d(e,{DF:function(){return c},Hz:function(){return D},Oo:function(){return m},Yy:function(){return h},bQ:function(){return y},cT:function(){return g},h8:function(){return u},u3:function(){return f}});var a=i(59540),s=i.n(a),o=i(81907),r=i(60305),n=i(38656),l=i(30858),d=i(55098);const c=(t,e)=>new Promise(((i,a)=>{const s=m(t,e);s.isValid||a(s.details),"geo-data"===e?p(t).then((t=>{i(t)})).catch((t=>{a(t)})):(0,r.M4)(t).then((t=>{i(t)})).catch((t=>{a(t)}))})),u=(t,e)=>new Promise(((i,a)=>{var s;((null===(s=e)||void 0===s?void 0:s.type.match(/.(jpg|jpeg)$/i))?S(e):Promise.resolve(void 0)).then((e=>{(0,n.pz)(t).then((a=>{const{width:s,height:o}=a;i(e?{src:t,width:s,height:o,provider:"uri",location:e}:{src:t,width:s,height:o,provider:"uri"})})).catch((t=>{a(t)}))}))})),h=(t,e)=>{if(e>d.Ry||t>d.Ry)throw l.S.MAX_FILE_SIZE_EXCEEDED},m=(t,e)=>{let i;switch(e){case"image":i=d.D6;break;case"video":i=d.GN;break;case"audio":i=d.Qx;break;case"image-or-video":i=[...d.D6,...d.GN];break;case"file-item":i=d.kI;break;case"geo-data":i=d.yB;break;default:return{isValid:!1,details:l.S.INVALID_FILE_TYPE}}const a=((t,e)=>t.type?-1!==e.findIndex((e=>e===t.type)):"name"in t&&D(t.name,e).length>0)(t,i);let s=e;a&&"image-or-video"===e&&(s=-1!==d.GN.findIndex((e=>e===t.type))?"video":"image");const o="image/gif"===t.type||"application/pdf"===t.type||"video"===s||"audio"===s?t.size>d.Tb:"geo-data"===s?t.size>d.Iv:t.size>d.WB,r=a&&!o;let n="";return a?o&&(n=l.S.MAX_FILE_SIZE_EXCEEDED):n=l.S.INVALID_FILE_TYPE,{isValid:r,details:n}},p=async t=>{var e;let i;try{i=await t.text()}catch{throw l.S.FILE_READ_ERROR}if(null===(e=i)||void 0===e?void 0:e.length)return i;throw l.S.FILE_READ_ERROR},g=t=>new Promise(((e,i)=>{const a=t.blob||(0,r.OP)(t.data.src),s=y(a.type),o={resourceName:s,resource:a,isAdd:!0};t.storyBuilder.upsertItemResource(o).then((()=>{const i={provider:"item-resource",resourceId:s,height:t.data.height,width:t.data.width};e(i)})).catch((()=>{i()}))})),y=t=>{let e=t.slice(t.indexOf("/")+1);return"svg+xml"===e&&(e="svg"),f(e)},f=t=>`${(0,o.x0)()}.${t}`,S=async t=>{try{var e,i;const a=await s().gps(t);return(null===(e=a)||void 0===e?void 0:e.latitude)&&(null===(i=a)||void 0===i?void 0:i.longitude)?{latitude:a.latitude,longitude:a.longitude}:void 0}catch(a){return}},D=(t,e)=>{for(const i of e){const e=new RegExp(`\\.${i}$`,"i");if(t.match(e))return i}return""}},89763:function(t,e,i){i.d(e,{Z:function(){return b}});var a=i(52322),s=i(28505),o=i.n(s),r=i(72779),n=i.n(r),l=i(36938),d=i(14176),c=i(37151),u=i(14535),h=i(25291),m=i(57293),p=i(9286),g=i(45822),y=i(2784),f=i(21689);const S="dismissed-callouts";function D(t){const[e,i]=(0,y.useState)(!1);(0,y.useEffect)((()=>{t&&(t=>(0,f.$o)({name:S,id:t}))(t)&&i(!0)}),[]);return[e,()=>{i(!0),t&&(t=>{(0,f.qQ)({name:S,id:t,value:!0})})(t)}]}var b=t=>{const{className:e,title:i,dismissedStorageId:s,children:r,closeButtonAriaLabel:y,size:f="large",hasIcon:S=!1,isDismissible:b=!1,marginTop:I="0",marginBottom:v="0"}=t,{theme:w,productVariables:P}=(0,u.Fj)(),[_,x]=D(s),R=(0,h.C)();if(_)return null;const E=w.colors.labelInformation,A={styles:(0,a.jsx)(o(),{id:"699875d21c4dbe4a",dynamic:[E,p.default.spacing.xs,p.default.spacing.xs,m.ZP.center(),p.default.responsiveBreakpoints.medium,p.default.spacing.sm,p.default.spacing.sm,p.default.responsiveBreakpoints.large,p.default.spacing.lg,p.default.spacing.lg],children:`.callout-icon.__jsx-style-dynamic-selector{background-color:${E};-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;width:${p.default.spacing.xs};height:${p.default.spacing.xs};${m.ZP.center()}\n    }@media(min-width:${p.default.responsiveBreakpoints.medium}){.callout-icon.__jsx-style-dynamic-selector{width:${p.default.spacing.sm};height:${p.default.spacing.sm}}}@media(min-width:${p.default.responsiveBreakpoints.large}){.callout-icon.__jsx-style-dynamic-selector{width:${p.default.spacing.lg};height:${p.default.spacing.lg}}}`}),className:o().dynamic([["699875d21c4dbe4a",[E,p.default.spacing.xs,p.default.spacing.xs,m.ZP.center(),p.default.responsiveBreakpoints.medium,p.default.spacing.sm,p.default.spacing.sm,p.default.responsiveBreakpoints.large,p.default.spacing.lg,p.default.spacing.lg]]])};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("aside",{role:"note",className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]])+" "+(n()("callout",f,e)||""),children:[S&&(0,a.jsxs)("div",{className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]]),children:[(0,a.jsx)(g.Z,{className:n()("callout-icon",A.className),fill:p.default.color.white,size:R?24:16,path:R?d.x:l.B,"aria-hidden":!0}),A.styles]}),(0,a.jsxs)("div",{className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]])+" callout-body",children:[i&&(0,a.jsx)("div",{className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]])+" callout-title",children:i}),r]}),b&&(0,a.jsx)("div",{className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]])+" dismissible-wrapper",children:(0,a.jsx)("button",{type:"button","aria-label":y,onClick:x,"data-testid":"callout-close-button",className:o().dynamic([["5239cdaca8611b72",[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs]]])+" callout-close-button",children:(0,a.jsx)(g.Z,{path:c.o,fill:w.colors.labelPrimary,"aria-hidden":!0})})})]}),(0,a.jsx)(o(),{id:"5239cdaca8611b72",dynamic:[p.default.spacing.xxs,w.colors.backgroundSecondary,w.colors.labelPrimary,p.default.spacing.xxxxs,E,P.borderRadius.regular,I,v,p.default.spacing.xxs,m.ZP.typography.bodySmall(),p.default.spacing.xxxs,p.default.spacing.xxs,m.ZP.typography.caption(),m.ZP.gappedList(p.default.spacing.xxs),w.colors.labelLink,w.colors.labelPrimary,m.ZP.typography.subtitleLarge(),m.ZP.typography.subtitleSmall(),p.default.spacing.xs,p.default.spacing.xs,p.default.responsiveBreakpoints.medium,p.default.spacing.xxxs,p.default.spacing.xs,p.default.spacing.xxxs],children:`.callout.__jsx-style-dynamic-selector{display:grid;grid-auto-flow:column;gap:${p.default.spacing.xxs};max-width:100%;background-color:${w.colors.backgroundSecondary};color:${w.colors.labelPrimary};-webkit-border-start:${p.default.spacing.xxxxs} solid ${E};-moz-border-start:${p.default.spacing.xxxxs} solid ${E};border-inline-start:${p.default.spacing.xxxxs} solid ${E};-webkit-border-radius:${P.borderRadius.regular};-moz-border-radius:${P.borderRadius.regular};border-radius:${P.borderRadius.regular};margin:${I} 0 ${v}}.callout.large.__jsx-style-dynamic-selector{padding:${p.default.spacing.xxs};${m.ZP.typography.bodySmall()}\n        }.callout.small.__jsx-style-dynamic-selector{padding:${p.default.spacing.xxxs} ${p.default.spacing.xxs};${m.ZP.typography.caption()}\n        }.callout-body.__jsx-style-dynamic-selector{${m.ZP.gappedList(p.default.spacing.xxs)}\n        }.callout-body.__jsx-style-dynamic-selector a{color:${w.colors.labelLink}}.callout-body.__jsx-style-dynamic-selector a.button{color:${w.colors.labelPrimary}}.large.__jsx-style-dynamic-selector .callout-title.__jsx-style-dynamic-selector{${m.ZP.typography.subtitleLarge()}\n        }.small.__jsx-style-dynamic-selector .callout-title.__jsx-style-dynamic-selector{${m.ZP.typography.subtitleSmall()}\n        }.callout-close-button.__jsx-style-dynamic-selector{width:${p.default.spacing.xs};height:${p.default.spacing.xs};padding:0}.dismissible-wrapper.__jsx-style-dynamic-selector{text-align:end}@media(min-width:${p.default.responsiveBreakpoints.medium}){.callout.__jsx-style-dynamic-selector{grid-row-gap:${p.default.spacing.xxxs}}.callout.large.__jsx-style-dynamic-selector{padding:${p.default.spacing.xs}}.callout-body.__jsx-style-dynamic-selector{grid-row-gap:${p.default.spacing.xxxs}}}`})]})}},86990:function(t,e,i){i.d(e,{_:function(){return h}});var a=i(52322),s=i(55704),o=i(25580),r=i(12845),n=i(52300),l=i(81962),d=i(79562),c=i(14535),u=i(45822);const h=t=>{const{theme:e}=(0,c.Fj)(),{className:i,accessLevel:h,color:m=e.colors.labelPrimary,isUnlisted:p=!1}=t,g={[d.eJ.PRIVATE]:n.K,[d.eJ.SHARED]:l.g,[d.eJ.PUBLIC]:s.d,[d.eJ.ORG]:r._,unlisted:o.I},y=p?"unlisted":h;return y?(0,a.jsx)(u.Z,{path:g[y],size:16,fill:m,className:i,"aria-hidden":t["aria-hidden"]}):null}},33160:function(t,e,i){i.d(e,{nj:function(){return u}});var a=i(52322),s=i(28505),o=i.n(s),r=i(2784);class n extends r.PureComponent{constructor(t){var e;super(t),e=this,this.hasMountedOnceHack=!1,this.state={currentStage:1},this.delayTimer=!1,this.onDelayFinished=!1,this.stages=[],this.previousStage=1,this.goToNextStage=()=>{if(this.delayTimer)return void(this.onDelayFinished=this.goToNextStage);const t=this.stages.length-1;var e,i;this.stages.findIndex(this.findCurrentStage)===t?null===(e=(i=this.props).onFinish)||void 0===e||e.call(i):this.setState((t=>({currentStage:t.currentStage+1})))},this.goToPreviousStage=()=>{if(this.delayTimer)return void(this.onDelayFinished=this.goToPreviousStage);var t,e;0===this.stages.findIndex(this.findCurrentStage)?null===(t=(e=this.props).onClose)||void 0===t||t.call(e):this.setState((t=>({currentStage:t.currentStage-1})))},this.goToStage=t=>{this.delayTimer?this.onDelayFinished=()=>{this.goToStage(t)}:this.stages.findIndex(this.findCurrentStage)>=0&&this.setState({currentStage:t})},this.registerStage=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=t-1,s={order:t,delay:i};e.stages[a]=s},this.onStageChange=()=>{const t=this.stages.find(this.findCurrentStage);t&&t.delay>0&&(this.delayTimer=setTimeout((()=>{clearTimeout(this.delayTimer),this.delayTimer=!1,"function"===typeof this.onDelayFinished&&(this.onDelayFinished(),this.onDelayFinished=!1)}),t.delay))},this.findCurrentStage=t=>t.order===this.state.currentStage}componentDidMount(){this.hasMountedOnceHack||(this.hasMountedOnceHack=!0,this.onStageChange())}componentDidUpdate(t,e){this.previousStage=this.state.currentStage,this.state.currentStage!==e.currentStage&&this.onStageChange()}render(){const t={currentStage:this.state.currentStage,registerStage:this.registerStage,previousStage:this.previousStage,direction:this.props.direction??"vertical"};return(0,a.jsxs)("div",{className:"jsx-2056219836549f7d staged-workflow controller",children:[this.props.children(t,this.goToNextStage,this.goToPreviousStage,this.goToStage),(0,a.jsx)(o(),{id:"2056219836549f7d",children:".controller.jsx-2056219836549f7d{position:absolute;width:100%;height:100%;top:0;right:0;overflow:hidden}"})]})}}var l=n,d=i(57293);class c extends r.PureComponent{get position(){return this.props.order-this.props.currentStage}componentDidMount(){this.hasMountedOnceHack||(this.hasMountedOnceHack=!0,this.props.registerStage(this.props.order,this.props.delay),this.props.order===this.props.currentStage&&this.onTransitionEnd())}render(){const t=this.position,e=0===this.position?0:this.position>0?1:-1,i=this.props.order===this.props.previousStage||0===t,s=()=>"horizontal"===this.props.direction?`transform: translateX(${100*e}%)`:`transform: translateY(${100*e}%)`;return(0,a.jsxs)("div",{onTransitionEnd:this.onTransitionEnd,className:o().dynamic([["2588f48e5aa9b7cd",[d.ZP.center()]],["165de802ceb3dd59",[s()]]])+" staged-workflow stage",children:[i&&this.props.children,(0,a.jsx)(o(),{id:"165de802ceb3dd59",dynamic:[s()],children:`.stage.__jsx-style-dynamic-selector{${s()}\n          }`}),(0,a.jsx)(o(),{id:"2588f48e5aa9b7cd",dynamic:[d.ZP.center()],children:`.stage.__jsx-style-dynamic-selector{position:absolute;width:100%;height:100%;right:0;overflow:auto;-webkit-overflow-scrolling:touch;top:0;-webkit-transition:-webkit-transform 400ms ease-in-out;-moz-transition:-moz-transform 400ms ease-in-out;-o-transition:-o-transform 400ms ease-in-out;transition:-webkit-transform 400ms ease-in-out;transition:-moz-transform 400ms ease-in-out;transition:-o-transform 400ms ease-in-out;transition:transform 400ms ease-in-out;${d.ZP.center()};}`})]})}constructor(...t){super(...t),this.hasMountedOnceHack=!1,this.onTransitionEnd=()=>{0===this.position&&"function"===typeof this.props.onStageReady&&this.props.onStageReady()}}}const u={Controller:l,Stage:c}},72603:function(t,e,i){var a=i(52322),s=(i(2784),i(74780));e.ZP=t=>e=>(0,a.jsx)(s.uL.Consumer,{children:i=>(0,a.jsx)(t,{...e,...i})})},25291:function(t,e,i){i.d(e,{C:function(){return o},x:function(){return s}});var a=i(15352);const s=t=>{const{isViewportMinWidth:e}=(0,a.uw)();return e(t)},o=()=>s("large")},89910:function(t,e,i){i.d(e,{Q:function(){return s},r:function(){return o}});var a=i(48206);const s=t=>{let{group:e,hasItemOwnerPermission:i,allowSharingToUpdateGroups:a}=t;var s,o,r;return!("admin"!==(null===(s=e.userMembership)||void 0===s?void 0:s.memberType)&&"owner"!==(null===(o=e.userMembership)||void 0===o?void 0:o.memberType)&&(e.isViewOnly||"member"!==(null===(r=e.userMembership)||void 0===r?void 0:r.memberType)||!i)||(a||e.capabilities&&e.capabilities.includes("updateitemcontrol"))&&!a)},o=async(t,e)=>(await(0,a.Ye)(t,{authentication:e,paging:{num:100,start:0}})).items.reduce(((t,e)=>(t.push(e.id),t)),[])},30819:function(t,e,i){i.d(e,{$9:function(){return l},TJ:function(){return d},jH:function(){return c}});var a=i(48206),s=i(43746),o=i(39613),r=i(73927),n=i(77468);const l=t=>/^draft(?:_\d+)?.json$/.test(t),d=t=>t.filter((t=>l(t.resource))).sort(((t,e)=>{var i,a,s,o;const n=new RegExp(`${r.AY}(?<timestamp>[0-9]+).json`,"g"),l=new RegExp(`${r.AY}(?<timestamp>[0-9]+).json`,"g"),d=null===(a=n.exec(t.resource))||void 0===a||null===(i=a.groups)||void 0===i?void 0:i.timestamp,c=null===(o=l.exec(e.resource))||void 0===o||null===(s=o.groups)||void 0===s?void 0:s.timestamp;return"undefined"===typeof d?1:"undefined"===typeof c?-1:Number(c)-Number(d)})),c=async t=>{const{itemDetails:e,...i}=t;try{const a=(t=>(0,n.W$)({typeKeywords:t.typeKeywords,typeKeywordId:r.W2})[0]||"draft.json")(e);return await(0,s.Dn)({...i,itemId:t.itemDetails.id,resourceId:a})}catch(l){if((0,n.$Y)(e)){return{...await(0,a.m_)(t.itemDetails.id,{authentication:t.authManager}),title:e.title,snippet:e.snippet}}const r=await(0,s.vb)({authManager:t.authManager,username:t.itemDetails.owner,itemId:t.itemDetails.id,portal:(0,o.Zl)(t.portalHost,t.authManager)}),c=d(r);for(const e of c)try{return await(0,s.Dn)({...i,itemId:t.itemDetails.id,resourceId:e.resource})}catch{}throw l}}},77468:function(t,e,i){i.d(e,{$Y:function(){return u},Ot:function(){return p},TQ:function(){return d},W$:function(){return l},_$:function(){return n},bk:function(){return h},c4:function(){return m},jT:function(){return c}});var a=i(43746),s=i(79562),o=i(73927),r=i(30858);const n=t=>!!l(t).length,l=t=>{var e,i,a;const s=`${t.typeKeywordId}:`;return(null===(a=t.typeKeywords)||void 0===a||null===(i=a.filter((t=>t.startsWith(s))))||void 0===i||null===(e=i.map((t=>t.replace(s,""))))||void 0===e?void 0:e.filter((t=>!!t)))??[]},d=t=>{var e;const i=`${t.typeKeywordId}:`;return(null===(e=t.typeKeywords)||void 0===e?void 0:e.filter((t=>!t.startsWith(i))))??[]},c=t=>{const e=`${t.typeKeywordId}:`;return[...(t.typeKeywords??[]).filter((t=>!t.startsWith(e))),...[t.data].flat().map((t=>`${e}${t}`))]},u=t=>t.typeKeywords&&t.typeKeywords.includes("storymapcollection")&&0===t.typeKeywords.filter((t=>/smversiondraft/.test(t))).length,h=t=>n({typeKeywords:t.typeKeywords,typeKeywordId:o.sO}),m=t=>l({typeKeywords:t.typeKeywords,typeKeywordId:o.L3}),p=t=>{if(t.type!==o.Cs&&t.type!==o.j3)return!1;if(!t||!t.typeKeywords||!t.typeKeywords.length)return r.PC.draft;const e=(t=>{const e=t.typeKeywords??[];return e.indexOf(r.PC.draft)>=0||e.indexOf("status:draft")>=0||(0,a.ZX)({typeKeywords:e})?r.PC.draft:e.indexOf(r.PC.published)>=0||e.indexOf("status:published")>=0||t.origin?r.PC.published:(e.indexOf(r.PC.unpublishedChanges)>=0||e.indexOf("status:unpublished-changes")>=0)&&r.PC.unpublishedChanges})(t);return e||(u(t)&&t.access!==s.eJ.PRIVATE?r.PC.published:r.PC.draft)}},50545:function(t,e,i){i.d(e,{$J:function(){return c},_H:function(){return d},x7:function(){return l}});var a=i(98537),s=i.n(a),o=i(43746),r=i(39613),n=i(30819);const l=t=>{let{currentProps:e,newProps:i}=t;return s()({},e,i)},d="DRAFT_DATA_RESOURCE",c=async t=>{let{resourceName:e,itemId:i,itemOwner:a,authManager:s,portalHost:l}=t;var c;const u=await(0,o.vb)({authManager:s,username:a,itemId:i,portal:(0,r.Zl)(l,s)});let h;var m;return h=e===d?(0,n.TJ)(u)[0]:u.filter((t=>t.resource===e))[0],(null===(c=h)||void 0===c?void 0:c.properties)&&JSON.parse(null===(m=h)||void 0===m?void 0:m.properties)||null}},73691:function(t,e,i){i.d(e,{L:function(){return n},f:function(){return r}});var a=i(48206),s=i(39613),o=i(43746);const r="published_data.json",n=async t=>{let{itemId:e,authManager:i,portalHost:n,language:l,onlyReturnPublishedDataJsonResource:d}=t;const c=i?void 0:(0,s.Zl)(n);try{return await(0,o.Dn)({itemId:e,resourceId:l?`published_data_${l}.json`:r,portalHost:n,authManager:i})}catch{if(!d)return await(0,a.m_)(e,{authentication:i,portal:c})}}}}]);